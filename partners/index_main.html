<!DOCTYPE html>
<html lang="es">

<head>
    <script src="https://static.readdy.ai/static/e.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lifextreme | V28 Hybrid AI - Ultimate Adventure Experience</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4338ca', secondary: '#10B981', accent: '#f85640',
                        yape: '#742183', plin: '#00d1ce', paypal: '#003087', bitcoin: '#f7931a'
                    },
                    borderRadius: { 'none': '0px', 'sm': '4px', DEFAULT: '8px', 'md': '12px', 'lg': '16px', 'xl': '20px', '2xl': '24px', '3xl': '32px', 'full': '9999px', 'button': '12px' }
                }
            }
        }

        // --- WISHLIST: INTENT DATA (V28) ---
        function toggleWishlist(id) {
            event.stopPropagation();
            const index = wishlist.indexOf(id);
            if (index > -1) {
                wishlist.splice(index, 1);
            } else {
                wishlist.push(id);
            }
            renderAll();
            updateWishlistDashboard();
        }

        function updateWishlistDashboard() {
            const container = document.getElementById('wishlist-container');
            if (!container) return;

            if (wishlist.length === 0) {
                container.innerHTML = `<p class="text-[10px] font-bold text-slate-400 italic">No tienes desaf√≠os guardados a√∫n. Explora destinos y a√±ade los que te inspiren.</p>`;
                return;
            }

            const items = wishlist.map(id => {
                const tour = tours.find(t => t.id === id);
                return `
                    <div class="flex items-center gap-4 bg-slate-50 p-4 rounded-3xl border border-slate-100 group hover:border-primary transition-all">
                        <img src="${tour.img}?w=100" class="w-12 h-12 rounded-xl object-cover">
                        <div class="flex-1">
                            <p class="text-[9px] font-black text-primary uppercase">${tour.dept}</p>
                            <p class="text-[11px] font-black italic text-slate-800">${tour.title}</p>
                        </div>
                        <button onclick="toggleWishlist(${id})" class="text-slate-300 hover:text-secondary p-2"><i class="ri-delete-bin-line"></i></button>
                    </div>
                `;
            }).join('');
            container.innerHTML = items;
        }

        // --- FEEDBACK SYSTEM (V28) ---
        function openFeedbackModal(tourId) {
            event.stopPropagation();
            activeFeedbackTour = completedTours.find(t => t.id === tourId);
            if (!activeFeedbackTour) return;

            currentRatings = { guide: 0, equipment: 0, difficulty: 0 };
            document.getElementById('feedback-tour-name').innerText = activeFeedbackTour.title;

            // Reset stars
            ['guide', 'equipment', 'difficulty'].forEach(cat => {
                const container = document.getElementById('rating-' + cat);
                container.querySelectorAll('i').forEach(star => {
                    star.classList.remove('ri-star-fill', 'text-accent');
                    star.classList.add('ri-star-line', 'text-slate-200');
                });
            });

            document.getElementById('feedback-modal').classList.remove('hidden');
        }

        function closeFeedbackModal() {
            document.getElementById('feedback-modal').classList.add('hidden');
        }

        function setRating(category, value) {
            currentRatings[category] = value;
            const container = document.getElementById('rating-' + category);
            const stars = container.querySelectorAll('i');

            stars.forEach((star, index) => {
                if (index < value) {
                    star.classList.remove('ri-star-line', 'text-slate-200');
                    star.classList.add('ri-star-fill', 'text-accent');
                } else {
                    star.classList.remove('ri-star-fill', 'text-accent');
                    star.classList.add('ri-star-line', 'text-slate-200');
                }
            });
        }

        function submitFeedback() {
            if (currentRatings.guide === 0 || currentRatings.equipment === 0 || currentRatings.difficulty === 0) {
                alert('Por favor califica todos los aspectos de tu expedici√≥n');
                return;
            }

            activeFeedbackTour.ratings = { ...currentRatings };
            closeFeedbackModal();
            updateCompletedToursDashboard();

            // Show success message
            alert('¬°Gracias por tu feedback! Esto nos ayuda a mejorar la experiencia.');
        }

        function updateCompletedToursDashboard() {
            const container = document.getElementById('completed-tours-container');
            if (!container) return;

            if (completedTours.length === 0) {
                container.innerHTML = `<p class="text-[10px] font-bold text-slate-400 italic">A√∫n no has completado ninguna expedici√≥n.</p>`;
                return;
            }

            const items = completedTours.map(tour => {
                const tourData = tours.find(t => t.id === tour.id);
                const hasRating = tour.ratings !== null;
                const avgRating = hasRating ? ((tour.ratings.guide + tour.ratings.equipment + tour.ratings.difficulty) / 3).toFixed(1) : 0;

                return `
                    <div class="flex items-center justify-between bg-slate-50 p-4 rounded-3xl border border-slate-100 group hover:border-primary transition-all">
                        <div class="flex items-center gap-4 flex-1">
                            <img src="${tourData.img}?w=100" class="w-12 h-12 rounded-xl object-cover">
                            <div class="flex-1">
                                <p class="text-[9px] font-black text-primary uppercase">${tourData.dept}</p>
                                <p class="text-[11px] font-black italic text-slate-800">${tour.title}</p>
                            </div>
                        </div>
                        ${hasRating ? `
                            <div class="flex items-center gap-2">
                                <div class="flex items-center gap-1">
                                    <i class="ri-star-fill text-accent text-sm"></i>
                                    <span class="text-[11px] font-black">${avgRating}</span>
                                </div>
                                <button onclick="openFeedbackModal(${tour.id})" class="text-[8px] font-black text-slate-400 hover:text-primary uppercase tracking-widest">Editar</button>
                            </div>
                        ` : `
                            <button onclick="openFeedbackModal(${tour.id})" class="bg-primary text-white px-4 py-2 rounded-xl text-[9px] font-black uppercase tracking-widest hover:bg-slate-900 transition-all">Calificar</button>
                        `}
                    </div>
                `;
            }).join('');
            container.innerHTML = items;
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@100;400;700;900&family=Montserrat:wght@400;600;800&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            scroll-behavior: smooth;
            overflow-x: hidden;
        }

        .logo-font {
            font-family: 'Outfit', sans-serif;
        }

        .logo-gradient {
            background: linear-gradient(135deg, #4338ca 0%, #f85640 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .section-view {
            display: none;
        }

        .section-view.active {
            display: block;
            animation: fadeIn 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fomo-popup {
            animation: slideInRight 0.5s cubic-bezier(0.23, 1, 0.32, 1);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .pulse-red {
            animation: pulseRed 2s infinite;
        }

        @keyframes pulseRed {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .fomo-popup {
            animation: slideInRight 0.5s cubic-bezier(0.23, 1, 0.32, 1);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .pulse-red {
            animation: pulseRed 2s infinite;
        }

        @keyframes pulseRed {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .region-chip {
            white-space: nowrap;
            padding: 10px 24px;
            border-radius: 99px;
            font-size: 10px;
            font-weight: 900;
            border: 1px solid #f1f5f9;
            cursor: pointer;
            transition: all 0.3s;
        }

        .region-chip.active {
            background: #4338ca;
            color: white;
            border-color: #4338ca;
            box-shadow: 0 10px 20px rgba(67, 56, 202, 0.1);
        }

        .timeline-line {
            position: absolute;
            left: 14px;
            top: 10px;
            bottom: 10px;
            width: 3px;
            background: #f85640;
            border-radius: 2px;
        }

        .step {
            position: relative;
            margin-bottom: 20px;
            padding-left: 40px;
        }

        .step-node {
            position: absolute;
            left: 0;
            top: 2px;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            border: 2px solid #f85640;
            background: white;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 900;
        }

        .nav-link.active {
            color: #4338ca;
            position: relative;
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 0;
            width: 100%;
            height: 3px;
            background: #4338ca;
            border-radius: 99px;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .day-box {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 800;
            cursor: pointer;
            border: 1px solid #f1f5f9;
        }

        .day-box.selected {
            background: #4338ca;
            color: white;
        }
    </style>
</head>

<body class="bg-[#fcfdff] min-h-screen">

    <!-- HEADER MASTER -->
    <header class="bg-white/90 backdrop-blur-2xl shadow-sm fixed top-0 w-full z-[1000] border-b border-slate-50">
        <div class="container mx-auto px-4 lg:px-6 py-4 flex justify-between items-center">
            <a href="#" onclick="navigateTo('home')" class="flex items-center group">
                <div
                    class="w-9 h-9 lg:w-11 lg:h-11 bg-primary rounded-2xl flex items-center justify-center text-white shadow-xl group-hover:rotate-12 transition-all">
                    <i class="ri-flashlight-fill text-lg lg:text-2xl"></i>
                </div>
                <div class="logo-font ml-2 lg:ml-3 leading-none select-none">
                    <span class="text-slate-900 font-normal text-lg lg:text-2xl tracking-tight">LIFE</span><span
                        class="logo-gradient font-black text-lg lg:text-2xl tracking-tighter italic">XTREME</span>
                </div>
            </a>

            <nav class="hidden xl:flex ml-12 space-x-10">
                <a href="javascript:void(0)" onclick="navigateTo('home')" id="nav-home"
                    class="nav-link active text-slate-500 font-bold text-[10px] uppercase tracking-widest">Inicio</a>
                <a href="javascript:void(0)" onclick="navigateTo('destinos')" id="nav-destinos"
                    class="nav-link text-slate-500 font-bold text-[10px] uppercase tracking-widest">Destinos</a>
                <a href="javascript:void(0)" onclick="navigateTo('eventos')" id="nav-eventos"
                    class="nav-link text-slate-500 font-bold text-[10px] uppercase tracking-widest text-accent">Eventos</a>
                <a href="javascript:void(0)" onclick="navigateTo('equipos')" id="nav-equipos"
                    class="nav-link text-slate-500 font-bold text-[10px] uppercase tracking-widest">Equipos</a>
                <a href="javascript:void(0)" onclick="navigateTo('guias')" id="nav-guias"
                    class="nav-link text-slate-500 font-bold text-[10px] uppercase tracking-widest">Gu√≠as</a>
                <a href="lifextreme_partners_final/index.html" target="_blank"
                    class="nav-link text-secondary font-bold text-[10px] uppercase tracking-widest flex items-center gap-2">
                    <i class="ri-building-line"></i> Partners
                </a>
            </nav>

            <div class="flex items-center gap-3 lg:gap-6">
                <!-- Partners CTA Button (Desktop) -->
                <a href="lifextreme_partners_final/index.html" target="_blank"
                    class="hidden lg:flex items-center gap-2 bg-gradient-to-r from-primary to-secondary text-white px-6 py-3 rounded-2xl font-black uppercase text-[9px] tracking-widest shadow-lg hover:shadow-xl hover:scale-105 transition-all">
                    <i class="ri-building-line text-sm"></i>
                    <span>Soy Operador</span>
                </a>

                <div class="hidden sm:flex items-center gap-3 cursor-pointer hover:bg-slate-50 p-2 rounded-2xl transition-all"
                    onclick="navigateTo('socio')">
                    <div class="text-right leading-none">
                        <p class="text-[8px] font-black text-primary uppercase">Socio Elite Active</p>
                        <p class="text-xs font-black">Alex R.</p>
                    </div>
                    <img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100"
                        class="w-10 h-10 rounded-xl object-cover border border-slate-100">
                </div>

                <!-- Language Selector -->
                <div class="flex items-center gap-2 bg-slate-50 rounded-xl p-1">
                    <button onclick="changeLanguage('es')" data-lang="es"
                        class="lang-btn active px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all">
                        üá™üá∏ ES
                    </button>
                    <button onclick="changeLanguage('en')" data-lang="en"
                        class="lang-btn px-3 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all">
                        üá¨üáß EN
                    </button>
                </div>

                <button onclick="toggleCart()"
                    class="w-10 h-10 lg:w-11 lg:h-11 bg-slate-50 rounded-xl flex items-center justify-center relative border border-slate-100"><i
                        class="ri-handbag-line text-lg"></i><span id="cart-count"
                        class="absolute -top-1 -right-1 bg-red-500 text-white text-[8px] font-bold rounded-full w-4 h-4 flex items-center justify-center">0</span></button>
                <button
                    class="xl:hidden w-10 h-10 bg-slate-50 rounded-xl flex items-center justify-center border border-slate-100"><i
                        class="ri-menu-4-line text-lg"></i></button>
            </div>
        </div>
    </header>

    <main>
        <!-- HOME: ULTRA-SYNTHESIS (V21 + Features) -->
        <section id="section-home" class="section-view active pt-24 lg:pt-32 pb-10 lg:pb-20">
            <div class="container mx-auto px-6">
                <!-- Landing Hero -->
                <div class="grid lg:grid-cols-2 gap-10 lg:gap-20 items-center mb-16 lg:mb-32">
                    <div class="text-center lg:text-left">
                        <span
                            class="bg-indigo-50 text-primary px-4 py-2 rounded-full text-[8px] lg:text-[9px] font-black uppercase tracking-[0.4em] mb-6 lg:mb-8 inline-block italic">Aventura
                            de Alta Gama</span>
                        <h1
                            class="text-4xl lg:text-7xl font-black text-slate-900 leading-[0.9] mb-6 lg:mb-8 tracking-tighter italic">
                            Domina el
                            <br><span class="logo-gradient">Territorio</span>
                        </h1>
                        <p class="text-md lg:text-lg text-slate-500 font-medium mb-8 lg:mb-12 max-w-lg mx-auto lg:mx-0">
                            Reserva expediciones regionales,
                            certifica tus habilidades en talleres t√©cnicos y obt√©n equipo de elite en un solo lugar.</p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
                            <button onclick="navigateTo('destinos')"
                                class="bg-primary text-white px-10 py-5 rounded-3xl font-black uppercase text-[10px] tracking-widest shadow-2xl hover:bg-slate-900 transition-all">Explorar
                                Mapa</button>
                            <button onclick="navigateTo('eventos')"
                                class="bg-white border-2 border-slate-100 px-10 py-5 rounded-3xl font-black uppercase text-[10px] tracking-widest hover:border-accent transition-all">Ver
                                Eventos</button>
                        </div>
                        <button onclick="openQuiz()"
                            class="mt-8 flex items-center gap-3 bg-indigo-50 px-6 py-3 rounded-2xl border border-indigo-100 hover:bg-white transition-all group">
                            <i class="ri-survey-line text-primary text-xl"></i>
                            <div>
                                <p class="text-[9px] font-black text-primary uppercase tracking-widest">¬øNo sabes qu√©
                                    elegir?</p>
                                <p class="text-[10px] font-black text-slate-800">Haz el Test de Aventura y gana -10%</p>
                            </div>
                            <i
                                class="ri-arrow-right-s-line text-slate-300 group-hover:translate-x-1 transition-all"></i>
                        </button>
                    </div>

                    <!-- COMPACT AI CHAT ASSISTANT -->
                    <div class="relative bg-white rounded-[40px] shadow-2xl border border-slate-200 overflow-hidden">
                        <!-- Chat Header -->
                        <div class="bg-gradient-to-r from-primary to-accent p-4 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-sm">
                                    <i class="ri-sparkling-fill text-white text-lg"></i>
                                </div>
                                <div>
                                    <p class="text-white font-black text-sm">Lifextreme AI</p>
                                    <p class="text-white/80 text-[9px] font-bold">Tu asistente de aventuras</p>
                                </div>
                            </div>
                            <div class="w-2 h-2 bg-secondary rounded-full animate-pulse"></div>
                        </div>

                        <!-- Messages Area (Compact - max 400px height) -->
                        <div id="compact-messages"
                            class="h-[260px] lg:h-[320px] overflow-y-auto p-4 lg:p-6 space-y-4 bg-gradient-to-b from-slate-50/50 to-white">
                            <!-- Welcome-->
                            <div class="flex gap-3 items-start">
                                <div
                                    class="w-8 h-8 bg-gradient-to-br from-primary to-accent rounded-xl flex items-center justify-center text-white flex-shrink-0">
                                    <i class="ri-sparkling-fill text-sm"></i>
                                </div>
                                <div
                                    class="flex-1 bg-white rounded-2xl rounded-tl-sm p-4 shadow-sm border border-slate-100">
                                    <p class="text-slate-800 text-xs font-semibold mb-2">¬°Hola! üëã ¬øQu√© aventura buscas?
                                    </p>
                                    <div class="grid grid-cols-2 gap-2 mt-3">
                                        <button onclick="sendCompactChat('Trekking en monta√±a')"
                                            class="bg-indigo-50 hover:bg-indigo-100 p-2 rounded-xl text-[9px] font-bold text-left transition-all">
                                            üèîÔ∏è Monta√±ismo
                                        </button>
                                        <button onclick="sendCompactChat('Expedici√≥n selva')"
                                            class="bg-emerald-50 hover:bg-emerald-100 p-2 rounded-xl text-[9px] font-bold text-left transition-all">
                                            üå¥ Selva
                                        </button>
                                        <button onclick="sendCompactChat('Equipamiento')"
                                            class="bg-orange-50 hover:bg-orange-100 p-2 rounded-xl text-[9px] font-bold text-left transition-all">
                                            üéí Equipo
                                        </button>
                                        <button onclick="sendCompactChat('Sorpr√©ndeme')"
                                            class="bg-purple-50 hover:bg-purple-100 p-2 rounded-xl text-[9px] font-bold text-left transition-all">
                                            ‚ú® Sorpresa
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Input Area -->
                        <div class="bg-white border-t border-slate-100 p-3 lg:p-4 flex items-center gap-2">
                            <input type="text" id="compact-input" placeholder="Escribe tu consulta..."
                                class="flex-1 px-4 py-3 bg-slate-50 rounded-2xl text-xs font-medium outline-none focus:ring-2 focus:ring-primary/20 transition-all"
                                onkeydown="if(event.key==='Enter') sendCompactChatFromInput()">
                            <button onclick="sendCompactChatFromInput()"
                                class="w-10 h-10 bg-primary hover:bg-slate-900 text-white rounded-xl flex items-center justify-center transition-all">
                                <i class="ri-send-plane-fill text-sm"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            </div>

            <!-- Continue with Membership CTA below -->
            <div class="container mx-auto px-6 mt-16 lg:mt-24">

                <!-- MEMBERSHIP CTA WITH COUNTDOWN -->
                <div
                    class="relative bg-gradient-to-br from-slate-900 via-primary to-slate-900 rounded-[40px] lg:rounded-[64px] shadow-3xl w-full h-[300px] lg:h-[600px] p-8 lg:p-12 flex flex-col justify-between overflow-hidden">
                    <!-- Animated Background Elements -->
                    <div class="absolute top-0 right-0 w-64 h-64 bg-accent/20 rounded-full blur-[120px] animate-pulse">
                    </div>
                    <div class="absolute bottom-0 left-0 w-80 h-80 bg-primary/30 rounded-full blur-[100px]"></div>

                    <!-- Content -->
                    <div class="relative z-10 flex flex-col h-full justify-between">
                        <!-- Header -->
                        <div class="text-center">
                            <span
                                class="bg-accent/20 text-accent px-4 py-2 rounded-full text-[9px] font-black uppercase tracking-[0.3em] inline-block mb-6 border border-accent/30 animate-pulse">
                                üî• Oferta Limitada
                            </span>
                            <h2
                                class="text-3xl lg:text-5xl font-black text-white leading-[0.95] mb-4 italic tracking-tight">
                                √önete al Club<br><span class="logo-gradient text-4xl lg:text-6xl">Elite</span>
                            </h2>
                            <p class="text-slate-300 font-bold text-sm lg:text-base mb-6">
                                Membres√≠a <span class="text-accent font-black">GRATIS</span> hasta
                            </p>
                        </div>

                        <!-- Countdown Timer -->
                        <div id="membership-timer" class="grid grid-cols-4 gap-2 lg:gap-4 mb-8">
                            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-3 lg:p-4 border border-white/20">
                                <div class="text-2xl lg:text-4xl font-black text-white" id="days">00</div>
                                <div
                                    class="text-[8px] lg:text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1">
                                    D√≠as</div>
                            </div>
                            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-3 lg:p-4 border border-white/20">
                                <div class="text-2xl lg:text-4xl font-black text-white" id="hours">00</div>
                                <div
                                    class="text-[8px] lg:text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1">
                                    Horas</div>
                            </div>
                            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-3 lg:p-4 border border-white/20">
                                <div class="text-2xl lg:text-4xl font-black text-white" id="minutes">00</div>
                                <div
                                    class="text-[8px] lg:text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1">
                                    Min</div>
                            </div>
                            <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-3 lg:p-4 border border-white/20">
                                <div class="text-2xl lg:text-4xl font-black text-white" id="seconds">00</div>
                                <div
                                    class="text-[8px] lg:text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1">
                                    Seg</div>
                            </div>
                        </div>

                        <!-- Benefits -->
                        <div class="space-y-3 mb-8">
                            <div class="flex items-center gap-3 text-white">
                                <div
                                    class="w-6 h-6 bg-secondary/30 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class="ri-check-line text-secondary text-sm"></i>
                                </div>
                                <span class="text-xs lg:text-sm font-bold">Descuentos exclusivos del 25%</span>
                            </div>
                            <div class="flex items-center gap-3 text-white">
                                <div
                                    class="w-6 h-6 bg-secondary/30 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class="ri-check-line text-secondary text-sm"></i>
                                </div>
                                <span class="text-xs lg:text-sm font-bold">Acceso prioritario a eventos</span>
                            </div>
                            <div class="flex items-center gap-3 text-white">
                                <div
                                    class="w-6 h-6 bg-secondary/30 rounded-lg flex items-center justify-center flex-shrink-0">
                                    <i class="ri-check-line text-secondary text-sm"></i>
                                </div>
                                <span class="text-xs lg:text-sm font-bold">Certificaciones gratis</span>
                            </div>
                        </div>

                        <!-- CTA Button -->
                        <button onclick="openMembershipModal()"
                            class="w-full bg-accent hover:bg-accent/90 text-white px-8 py-5 rounded-2xl font-black uppercase text-[11px] lg:text-[13px] tracking-widest shadow-2xl hover:scale-105 transition-all duration-300 flex items-center justify-center gap-3 group">
                            <span>Activar Membres√≠a Gratis</span>
                            <i class="ri-arrow-right-line text-xl group-hover:translate-x-2 transition-all"></i>
                        </button>

                        <p class="text-[8px] lg:text-[9px] text-slate-400 text-center mt-4 font-bold">
                            Sin tarjeta de cr√©dito ‚Ä¢ Cancela cuando quieras
                        </p>
                    </div>
                </div>
            </div>
            </div>

            <!-- App Launch (V21) -->
            <div
                class="bg-slate-900 rounded-[40px] lg:rounded-[56px] p-8 lg:p-20 flex flex-col lg:flex-row items-center gap-10 lg:gap-20 overflow-hidden relative">
                <div class="absolute top-0 right-0 w-80 h-80 bg-primary/20 rounded-full blur-[100px]"></div>
                <div class="flex-1 text-white z-10 text-center lg:text-left">
                    <h2 class="text-3xl lg:text-4xl font-black mb-6">Lifextreme <span class="text-accent italic">Pro
                            App</span>
                    </h2>
                    <ul class="space-y-4 mb-10 text-slate-400 font-bold text-xs lg:text-sm">
                        <li class="flex items-center justify-center lg:justify-start gap-3"><i
                                class="ri-map-2-line text-accent"></i> Mapas T√°cticos
                            Offline</li>
                        <li class="flex items-center justify-center lg:justify-start gap-3"><i
                                class="ri-focus-3-line text-accent"></i> AR para
                            Identificaci√≥n de Cumbres</li>
                        <li class="flex items-center justify-center lg:justify-start gap-3"><i
                                class="ri-qr-code-line text-accent"></i> Esc√°ner de
                            Senderos Seguro</li>
                    </ul>
                    <div
                        class="bg-white/10 p-2 lg:p-3 rounded-2xl flex flex-col sm:flex-row gap-3 max-w-md mx-auto lg:mx-0 border border-white/5">
                        <input type="email" placeholder="Inscr√≠bete para el lanzamiento"
                            class="bg-transparent flex-1 px-4 py-3 lg:py-0 text-xs outline-none font-bold text-white placeholder-slate-500">
                        <button
                            class="bg-accent text-white px-6 py-3 rounded-xl font-black uppercase text-[9px] tracking-widest">Inscribirme</button>
                    </div>
                </div>
                <div class="flex-1 w-full">
                    <img src="https://images.unsplash.com/photo-1542332213-9b5a5a3fad35"
                        class="rounded-[30px] lg:rounded-[40px] shadow-2xl skew-x-0 lg:skew-x-1 opacity-80 w-full h-48 lg:h-auto object-cover">
                </div>
            </div>
            </div>
        </section>

        <!-- DESTINOS: THE REGIONAL HUB (V24 + V22) -->
        <section id="section-destinos" class="section-view pt-32 pb-20">
            <div class="container mx-auto px-6">
                <div class="mb-16">
                    <h2 class="text-4xl font-black mb-10 italic">Exploraci√≥n <span class="logo-gradient">Nacional</span>
                    </h2>
                    <!-- Region Selector (V24) -->
                    <div class="flex gap-4 overflow-x-auto pb-6 no-scrollbar" id="region-selector">
                        <div class="region-chip active" onclick="selRegion('Todos')">Todos</div>
                        <div class="region-chip" onclick="selRegion('Cusco')">Cusco</div>
                        <div class="region-chip" onclick="selRegion('Huaraz')">Huaraz</div>
                        <div class="region-chip" onclick="selRegion('Iquitos')">Iquitos</div>
                        <div class="region-chip" onclick="selRegion('Piura')">Piura</div>
                        <div class="region-chip" onclick="selRegion('Ica')">Ica</div>
                        <div class="region-chip" onclick="selRegion('Puno')">Puno</div>
                        <div class="region-chip" onclick="selRegion('Arequipa')">Arequipa</div>
                    </div>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8" id="destinos-grid">
                    <!-- JS Injection -->
                </div>
            </div>
        </section>

        <!-- EVENTOS: THE HUB (V25) -->
        <section id="section-eventos" class="section-view pt-32 pb-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-black mb-4">Competencias & <span
                            class="text-accent italic">Festivales</span></h2>
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Calendario de Comunidad
                        2026</p>
                </div>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-10" id="events-grid">
                    <!-- JS Injection -->
                </div>
            </div>
        </section>

        <!-- EQUIPOS (V14) -->
        <section id="section-equipos" class="section-view pt-32 pb-20">
            <div class="container mx-auto px-6">
                <div class="flex flex-col lg:flex-row gap-12">
                    <div
                        class="w-full lg:w-[300px] h-fit sticky top-32 space-y-8 bg-white p-10 rounded-[40px] border border-slate-50 shadow-sm">
                        <h3 class="font-black text-2xl">Equipamiento</h3>
                        <div class="space-y-4">
                            <label class="flex items-center gap-3 text-sm font-bold cursor-pointer"
                                onclick="renderAll('Todos', 'Mochilas')"><input type="radio" name="eq"
                                    class="accent-primary"> Mochilas</label>
                            <label class="flex items-center gap-3 text-sm font-bold cursor-pointer"
                                onclick="renderAll('Todos', 'Calzado')"><input type="radio" name="eq"
                                    class="accent-primary"> Calzado</label>
                            <label class="flex items-center gap-3 text-sm font-bold cursor-pointer"
                                onclick="renderAll('Todos', 'Accesorios')"><input type="radio" name="eq"
                                    class="accent-primary"> Accesorios</label>
                            <label class="flex items-center gap-3 text-sm font-bold cursor-pointer"
                                onclick="renderAll('Todos', 'Todos')"><input type="radio" name="eq" checked
                                    class="accent-primary"> Ver Todo</label>
                        </div>
                    </div>
                    <div class="flex-1 grid md:grid-cols-2 gap-8" id="equip-grid">
                        <!-- JS Injection -->
                    </div>
                </div>
            </div>
        </section>

        <!-- GUIAS (V19) -->
        <section id="section-guias" class="section-view pt-32 pb-20">
            <div class="container mx-auto px-6">
                <h2 class="text-4xl font-black text-center mb-16 italic">Staff de <span class="logo-gradient">Gu√≠as
                        Elite</span></h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8" id="guides-grid">
                    <!-- JS Injection -->
                </div>
            </div>
        </section>
        <!-- SOCIO: DASHBOARD T√ÅCTICO (V28) -->
        <section id="section-socio" class="section-view pt-24 lg:pt-32 pb-20">
            <div class="container mx-auto px-6 max-w-6xl">
                <div class="flex flex-col lg:flex-row gap-12 items-start">
                    <!-- Sidebar: Perfil -->
                    <div
                        class="w-full lg:w-1/3 bg-white rounded-[48px] p-10 shadow-3xl border border-slate-50 relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-primary/5 rounded-full -mr-16 -mt-16"></div>
                        <div class="relative z-10 flex flex-col items-center text-center">
                            <img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=300"
                                class="w-24 h-24 rounded-3xl object-cover shadow-2xl mb-6">
                            <h2 class="text-2xl font-black italic mb-1">Alex R.</h2>
                            <p class="text-[10px] font-black text-primary uppercase tracking-widest mb-8">Socio #LF-0026
                                ‚Ä¢ Elite</p>

                            <div class="grid grid-cols-2 gap-4 w-full">
                                <div class="bg-slate-50 p-4 rounded-2xl text-center">
                                    <p class="text-[8px] font-black text-slate-400 uppercase mb-1">Expediciones</p>
                                    <p class="text-xl font-black italic">14</p>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-2xl text-center">
                                    <p class="text-[8px] font-black text-slate-400 uppercase mb-1">Altitud Max</p>
                                    <p class="text-xl font-black italic">6,075m</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content: Progreso -->
                    <div class="w-full lg:w-2/3 space-y-8">
                        <div
                            class="bg-slate-900 rounded-[48px] p-10 lg:p-12 text-white shadow-3xl relative overflow-hidden">
                            <i class="ri-shield-flash-fill absolute -bottom-10 -right-10 text-[200px] opacity-10"></i>
                            <h3 class="text-2xl font-black italic mb-8">Pasaporte de Habilidades</h3>

                            <div class="space-y-6">
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-[10px] font-black uppercase tracking-widest">Alta Monta√±a
                                            (T√©cnico)</span>
                                        <span class="text-xs font-black italic text-primary">Nivel 4</span>
                                    </div>
                                    <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                        <div
                                            class="h-full bg-primary w-[85%] rounded-full shadow-[0_0_20px_rgba(67,56,202,0.5)]">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-[10px] font-black uppercase tracking-widest">Selva &
                                            Supervivencia</span>
                                        <span class="text-xs font-black italic text-secondary">Nivel 2</span>
                                    </div>
                                    <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                        <div
                                            class="h-full bg-secondary w-[40%] rounded-full shadow-[0_0_20px_rgba(244,63,94,0.5)]">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-[10px] font-black uppercase tracking-widest">Costa &
                                            Acu√°ticos</span>
                                        <span class="text-xs font-black italic text-accent">Nivel 3</span>
                                    </div>
                                    <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                        <div
                                            class="h-full bg-accent w-[65%] rounded-full shadow-[0_0_20px_rgba(255,191,0,0.5)]">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="bg-white rounded-[40px] p-8 border border-slate-50 shadow-sm">
                                <h4 class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-6">
                                    Certificaciones Activas</h4>
                                <div class="flex flex-wrap gap-3">
                                    <div class="bg-primary/5 text-primary p-3 rounded-2xl flex items-center gap-3">
                                        <i class="ri-heart-pulse-fill"></i>
                                        <span class="text-[10px] font-black">Rescate WFR</span>
                                    </div>
                                    <div class="bg-indigo-50 text-indigo-600 p-3 rounded-2xl flex items-center gap-3">
                                        <i class="ri-windy-fill"></i>
                                        <span class="text-[10px] font-black">Escalada Hielo</span>
                                    </div>
                                    <div
                                        class="bg-slate-50 text-slate-400 p-3 rounded-2xl flex items-center gap-3 border border-dashed border-slate-200">
                                        <i class="ri-add-line"></i>
                                        <span class="text-[10px] font-black">Certif√≠cate</span>
                                    </div>
                                </div>
                            </div>
                            <div
                                class="bg-white rounded-[40px] p-8 border border-slate-50 shadow-sm flex items-center justify-between">
                                <div>
                                    <h4 class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-1">
                                        Lifextreme Tokens</h4>
                                    <p class="text-3xl font-black italic">2,450 <span class="text-xs">LXT</span></p>
                                </div>
                                <div
                                    class="w-12 h-12 bg-accent/20 text-accent rounded-2xl flex items-center justify-center">
                                    <i class="ri-copper-coin-fill text-2xl"></i>
                                </div>
                            </div>
                        </div>

                        <!-- PR√ìXIMOS DESAF√çOS (WISHLIST) -->
                        <div class="bg-white rounded-[40px] p-10 border border-slate-50 shadow-sm">
                            <div class="flex justify-between items-center mb-8">
                                <h4 class="text-[10px] font-black text-slate-800 uppercase tracking-widest">Mis Pr√≥ximos
                                    Desaf√≠os</h4>
                                <span
                                    class="bg-indigo-50 text-primary text-[8px] font-black px-3 py-1 rounded-full uppercase">Data
                                    de Intenci√≥n</span>
                            </div>
                            <div id="wishlist-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- JS Injection -->
                            </div>
                        </div>

                        <!-- EXPEDICIONES COMPLETADAS (FEEDBACK) -->
                        <div class="bg-white rounded-[40px] p-10 border border-slate-50 shadow-sm">
                            <div class="flex justify-between items-center mb-8">
                                <h4 class="text-[10px] font-black text-slate-800 uppercase tracking-widest">Expediciones
                                    Completadas</h4>
                                <span
                                    class="bg-secondary/10 text-secondary text-[8px] font-black px-3 py-1 rounded-full uppercase">Data
                                    de Calidad</span>
                            </div>
                            <div id="completed-tours-container" class="space-y-4">
                                <!-- JS Injection -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER (V21 Style) -->
    <footer class="bg-slate-900 text-white py-16 lg:py-24">
        <div class="container mx-auto px-6">
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-12 lg:gap-20 mb-16 lg:mb-20">
                <div class="col-span-1 lg:col-span-2">
                    <div class="flex items-center mb-8">
                        <div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center text-white mr-3"><i
                                class="ri-flashlight-fill text-xl"></i></div>
                        <div class="logo-font leading-none"><span
                                class="text-white font-normal text-xl tracking-tight">LIFE</span><span
                                class="logo-gradient font-black text-xl tracking-tighter italic">XTREME</span></div>
                    </div>
                    <p class="text-slate-400 max-w-sm mb-10 text-sm lg:text-lg leading-relaxed">Redefiniendo el turismo
                        de aventura en Per√∫ con est√°ndares de elite y tecnolog√≠a t√°ctica.</p>
                    <div class="flex gap-4">
                        <a href="#"
                            class="w-10 h-10 bg-white/5 rounded-xl flex items-center justify-center hover:bg-primary transition-all"><i
                                class="ri-instagram-line"></i></a>
                        <a href="#"
                            class="w-10 h-10 bg-white/5 rounded-xl flex items-center justify-center hover:bg-primary transition-all"><i
                                class="ri-youtube-line"></i></a>
                        <a href="#"
                            class="w-10 h-10 bg-white/5 rounded-xl flex items-center justify-center hover:bg-primary transition-all"><i
                                class="ri-twitter-x-line"></i></a>
                    </div>
                </div>
                <div>
                    <h5 class="font-black mb-8 uppercase text-[10px] tracking-widest">Explorar</h5>
                    <ul class="space-y-4 text-slate-400 font-bold text-sm">
                        <li><a href="#" class="hover:text-white transition-all">Mapa Regional</a></li>
                        <li><a href="#" class="hover:text-white transition-all">Certificaciones</a></li>
                        <li><a href="#" class="hover:text-white transition-all">Mochila Pro</a></li>
                        <li><a href="#" class="hover:text-white transition-all">Comunidad Elite</a></li>
                    </ul>
                </div>
                <div>
                    <h5 class="font-black mb-8 uppercase text-[10px] tracking-widest">Soporte</h5>
                    <ul class="space-y-4 text-slate-400 font-bold text-sm">
                        <li><a href="#" class="hover:text-white transition-all">Centro T√°ctico</a></li>
                        <li><a href="#" class="hover:text-white transition-all">Seguro Expedici√≥n</a></li>
                        <li><a href="#" class="hover:text-white transition-all">Preguntas Frecuentes</a></li>
                        <li><a href="#" class="hover:text-white transition-all">Lito & Alex</a></li>
                    </ul>
                </div>
            </div>
            <div
                class="border-t border-white/5 pt-10 text-center text-slate-500 text-[10px] font-black uppercase tracking-widest">
                ¬© 2026 Lifextreme Pro System. All Rights Reserved.</div>
        </div>
    </footer>

    <!-- MODAL: ADVANCED BOOKING (V16 + V22) -->
    <!-- MODAL: ADVANCED BOOKING (V28 REVISION) -->
    <div id="booking-modal"
        class="hidden fixed inset-0 z-[2000] bg-slate-900/60 backdrop-blur-md flex items-center justify-center p-4 lg:p-12 overflow-y-auto">
        <div
            class="bg-white w-full max-w-7xl rounded-[64px] overflow-hidden flex flex-col lg:flex-row shadow-3xl min-h-[85vh]">
            <!-- Left: Itinerary & Content -->
            <div class="flex-[1.5] p-8 lg:p-20 overflow-y-auto max-h-[60vh] lg:max-h-screen">
                <div class="space-y-16">
                    <div class="grid lg:grid-cols-4 gap-8">
                        <div class="col-span-1">
                            <h4 class="font-black text-xl italic leading-none">Tu itinerario</h4>
                            <p class="text-[9px] font-black text-slate-400 uppercase mt-4">Paso a paso</p>
                        </div>
                        <div class="col-span-3 relative" id="itinerary-flow">
                            <!-- JS Inject -->
                        </div>
                    </div>

                    <!-- NEW: General Information Section (V29) -->
                    <div class="grid lg:grid-cols-4 gap-8 pt-8 border-t border-slate-50">
                        <div class="col-span-1">
                            <h4 class="font-black text-xl italic leading-none">Informaci√≥n general</h4>
                        </div>
                        <div class="col-span-3">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                <div class="flex items-start gap-4">
                                    <div
                                        class="w-10 h-10 bg-slate-50 rounded-xl flex items-center justify-center text-slate-400 shrink-0">
                                        <i class="ri-calendar-event-line text-lg"></i>
                                    </div>
                                    <div>
                                        <p class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-1">
                                            Pol√≠tica de cancelaci√≥n</p>
                                        <p id="b-cancel-policy" class="text-[11px] font-bold text-slate-500"></p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-4">
                                    <div
                                        class="w-10 h-10 bg-slate-50 rounded-xl flex items-center justify-center text-slate-400 shrink-0">
                                        <i class="ri-time-line text-lg"></i>
                                    </div>
                                    <div>
                                        <p class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-1">
                                            Duraci√≥n</p>
                                        <p id="b-duration" class="text-[11px] font-bold text-slate-500"></p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-4">
                                    <div
                                        class="w-10 h-10 bg-slate-50 rounded-xl flex items-center justify-center text-slate-400 shrink-0">
                                        <i class="ri-check-double-line text-lg"></i>
                                    </div>
                                    <div>
                                        <p class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-1">
                                            Disponibilidad</p>
                                        <p id="b-availability" class="text-[11px] font-bold text-slate-500"></p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-4">
                                    <div
                                        class="w-10 h-10 bg-slate-50 rounded-xl flex items-center justify-center text-slate-400 shrink-0">
                                        <i class="ri-user-voice-line text-lg"></i>
                                    </div>
                                    <div>
                                        <p class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-1">
                                            Gu√≠a</p>
                                        <p id="b-guide-lang" class="text-[11px] font-bold text-slate-500"></p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-4">
                                    <div
                                        class="w-10 h-10 bg-slate-50 rounded-xl flex items-center justify-center text-slate-400 shrink-0">
                                        <i class="ri-group-line text-lg"></i>
                                    </div>
                                    <div>
                                        <p class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-1">
                                            Grupo reducido</p>
                                        <p id="b-group-size" class="text-[11px] font-bold text-slate-500"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid lg:grid-cols-4 gap-8 pt-8 border-t border-slate-50">
                        <div class="col-span-1">
                            <h4 class="font-black text-xl italic leading-none">Qu√© har√°s</h4>
                        </div>
                        <div class="col-span-3">
                            <ul class="space-y-4 text-[11px] font-bold text-slate-700" id="itinerary-what-you-do">
                                <!-- Inject bullet points -->
                            </ul>
                        </div>
                    </div>

                    <div class="grid lg:grid-cols-4 gap-8 pt-8 border-t border-slate-50">
                        <div class="col-span-1">
                            <h4 class="font-black text-xl italic leading-none">En detalle</h4>
                        </div>
                        <div class="col-span-3">
                            <div class="space-y-8" id="itinerary-detailed-days">
                                <!-- Day by day injected here -->
                            </div>
                        </div>
                    </div>

                    <div class="grid lg:grid-cols-4 gap-8 pt-8 border-t border-slate-50">
                        <div class="col-span-1">
                            <h4 class="font-black text-xl italic leading-none">Qu√© incluye</h4>
                        </div>
                        <div class="col-span-3">
                            <ul class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-[11px] font-black text-slate-800"
                                id="itinerary-inclusions">
                                <!-- Inject inclusions -->
                            </ul>
                        </div>
                    </div>

                    <!-- NEW: Restrictions Section (V29) -->
                    <div class="grid lg:grid-cols-4 gap-8 pt-8 border-t border-slate-50">
                        <div class="col-span-1">
                            <h4 class="font-black text-xl italic leading-none text-red-500">No apto para</h4>
                        </div>
                        <div class="col-span-3">
                            <ul class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-[11px] font-bold text-slate-500"
                                id="itinerary-restrictions">
                                <!-- JS Inject -->
                            </ul>
                        </div>
                    </div>

                    <!-- NEW: Meeting Point Section (V29) -->
                    <div class="grid lg:grid-cols-4 gap-8 pt-8 border-t border-slate-50">
                        <div class="col-span-1">
                            <h4 class="font-black text-xl italic leading-none">Punto de encuentro</h4>
                        </div>
                        <div class="col-span-3 flex flex-col sm:flex-row gap-6 items-start">
                            <div class="flex-1">
                                <p id="b-meeting-point" class="text-[11px] font-bold text-slate-700 leading-relaxed">
                                </p>
                                <a href="https://maps.google.com" target="_blank"
                                    class="mt-4 inline-flex items-center gap-2 text-primary font-black text-[9px] uppercase tracking-widest hover:underline">
                                    <i class="ri-map-pin-2-fill"></i> Abrir en Google Maps
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- NEW: Important Information Section (V29) -->
                    <div class="grid lg:grid-cols-4 gap-8 pt-8 border-t border-slate-50 pb-20">
                        <div class="col-span-1">
                            <h4 class="font-black text-xl italic leading-none text-accent">Informaci√≥n importante</h4>
                        </div>
                        <div class="col-span-3">
                            <h5 class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-4">Qu√© llevar
                            </h5>
                            <p id="b-important-info" class="text-[11px] font-bold text-slate-500 leading-relaxed"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right: Action Panel (V16/V20 Style) -->
            <div class="flex-1 p-8 lg:p-16 flex flex-col bg-slate-50 relative">
                <button onclick="closeModal()"
                    class="hidden lg:flex absolute top-12 right-12 w-14 h-14 bg-white rounded-3xl items-center justify-center hover:bg-slate-900 hover:text-white transition-all shadow-xl group">
                    <i class="ri-close-large-line text-xl group-hover:rotate-90 transition-all"></i>
                </button>

                <div class="mb-8 lg:mb-12">
                    <span id="b-dept"
                        class="text-[10px] font-black text-primary uppercase tracking-[0.4em] mb-4 block"></span>
                    <h2 id="b-title"
                        class="text-3xl lg:text-5xl font-black text-slate-900 tracking-tighter italic leading-none mb-4">
                    </h2>
                    <!-- FOOTER (V21 Style) -->
                    <footer class="bg-slate-900 text-white py-16 lg:py-24">
                        <div class="container mx-auto px-6">
                            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-12 lg:gap-20 mb-16 lg:mb-20">
                                <div class="col-span-1 lg:col-span-2">
                                    <div class="flex items-center mb-8">
                                        <div
                                            class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center text-white mr-3">
                                            <i class="ri-flashlight-fill text-xl"></i>
                                        </div>
                                        <div class="logo-font leading-none"><span
                                                class="text-white font-normal text-xl tracking-tight">LIFE</span><span
                                                class="logo-gradient font-black text-xl tracking-tighter italic">XTREME</span>
                                        </div>
                                    </div>
                                    <p class="text-slate-400 max-w-sm mb-10 text-sm lg:text-lg leading-relaxed">
                                        Redefiniendo el turismo de aventura en Per√∫ con est√°ndares de elite y tecnolog√≠a
                                        t√°ctica.</p>
                                    <div class="flex gap-4">
                                        <a href="#"
                                            class="w-10 h-10 bg-white/5 rounded-xl flex items-center justify-center hover:bg-primary transition-all"><i
                                                class="ri-instagram-line"></i></a>
                                        <a href="#"
                                            class="w-10 h-10 bg-white/5 rounded-xl flex items-center justify-center hover:bg-primary transition-all"><i
                                                class="ri-youtube-line"></i></a>
                                        <a href="#"
                                            class="w-10 h-10 bg-white/5 rounded-xl flex items-center justify-center hover:bg-primary transition-all"><i
                                                class="ri-twitter-x-line"></i></a>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-black mb-8 uppercase text-[10px] tracking-widest">Explorar</h5>
                                    <ul class="space-y-4 text-slate-400 font-bold text-sm">
                                        <li><a href="#" class="hover:text-white transition-all">Mapa Regional</a></li>
                                        <li><a href="#" class="hover:text-white transition-all">Certificaciones</a></li>
                                        <li><a href="#" class="hover:text-white transition-all">Mochila Pro</a></li>
                                        <li><a href="#" class="hover:text-white transition-all">Comunidad Elite</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <h5 class="font-black mb-8 uppercase text-[10px] tracking-widest">Soporte</h5>
                                    <ul class="space-y-4 text-slate-400 font-bold text-sm">
                                        <li><a href="#" class="hover:text-white transition-all">Centro T√°ctico</a></li>
                                        <li><a href="#" class="hover:text-white transition-all">Seguro Expedici√≥n</a>
                                        </li>
                                        <li><a href="#" class="hover:text-white transition-all">Preguntas Frecuentes</a>
                                        </li>
                                        <li><a href="#" class="hover:text-white transition-all">Lito & Alex</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div
                                class="border-t border-white/5 pt-10 text-center text-slate-500 text-[10px] font-black uppercase tracking-widest">
                                ¬© 2026 Lifextreme Pro System. All Rights Reserved.</div>
                        </div>
                    </footer>
                    <div class="flex items-center gap-4">
                        <div class="flex text-accent text-sm"><i class="ri-star-fill"></i><i class="ri-star-fill"></i><i
                                class="ri-star-fill"></i><i class="ri-star-fill"></i><i class="ri-star-fill"></i></div>
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">4.9 (Elite
                            Service)</span>
                    </div>
                </div>

                <div class="bg-white p-6 lg:p-10 rounded-[48px] shadow-sm border border-slate-100 mb-8">
                    <p class="text-[10px] font-black text-slate-300 uppercase tracking-widest mb-4 text-center">
                        Configuraci√≥n de Reserva</p>
                    <div id="availability-status" class="h-8 flex items-center justify-center mb-4 italic text-center">
                    </div>
                    <div class="grid grid-cols-7 gap-2 lg:gap-3 mb-8 lg:mb-10" id="calendar-grid"><!-- JS Inject -->
                    </div>
                    <div class="flex justify-between items-center bg-slate-50 p-4 lg:p-6 rounded-3xl">
                        <div class="flex items-center gap-4">
                            <button onclick="changePax(-1)"
                                class="w-10 h-10 bg-white rounded-xl shadow-sm flex items-center justify-center hover:bg-slate-100 transition-all"><i
                                    class="ri-subtract-line font-black"></i></button>
                            <span id="pax-count" class="font-black text-lg">01</span>
                            <button onclick="changePax(1)"
                                class="w-10 h-10 bg-white rounded-xl shadow-sm flex items-center justify-center hover:bg-slate-100 transition-all"><i
                                    class="ri-add-line font-black"></i></button>
                        </div>
                        <p class="text-[9px] font-black text-slate-400 uppercase italic">Participantes Elite</p>
                    </div>
                </div>

                <div
                    class="bg-slate-900 p-8 lg:p-10 rounded-[48px] flex justify-between items-center text-white mt-auto shadow-3xl overflow-hidden relative">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-primary blur-[64px] opacity-30"></div>
                    <div class="relative z-10 text-left">
                        <p class="text-[10px] font-black text-indigo-300 uppercase italic mb-1">Confirmaci√≥n T√°ctica</p>
                        <p id="b-total-price" class="text-3xl lg:text-5xl font-black italic tracking-tighter">S/ 0</p>
                    </div>
                </div>

                <!-- SMART BUNDLING SECTION (V28) -->
                <div class="mt-8 bg-indigo-50/50 p-6 lg:p-8 rounded-[40px] border border-indigo-100">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="ri-gift-line text-primary text-xl"></i>
                        <h4 class="font-black text-sm uppercase tracking-widest italic">Mejora tu Expedici√≥n</h4>
                    </div>
                    <div class="space-y-4">
                        <label
                            class="flex items-center justify-between p-4 bg-white rounded-2xl cursor-pointer border border-transparent hover:border-primary transition-all group">
                            <div class="flex items-center gap-3">
                                <input type="checkbox" class="addon-check w-5 h-5 accent-primary"
                                    onchange="toggleAddon('insurance', 45, 'Seguro de Rescate T√°ctico')">
                                <div>
                                    <p class="text-[11px] font-black text-slate-800">Seguro de Rescate T√°ctico</p>
                                    <p class="text-[9px] font-bold text-slate-400 italic">Cobertura 100% en alta monta√±a
                                    </p>
                                </div>
                            </div>
                            <span class="text-xs font-black text-primary italic">+ S/ 45</span>
                        </label>
                        <label
                            class="flex items-center justify-between p-4 bg-white rounded-2xl cursor-pointer border border-transparent hover:border-primary transition-all group">
                            <div class="flex items-center gap-3">
                                <input type="checkbox" class="addon-check w-5 h-5 accent-primary"
                                    onchange="toggleAddon('gear', 120, 'Rental Kit Pro (Osprey/Black Diamond)')">
                                <div>
                                    <p class="text-[11px] font-black text-slate-800">Rental Kit Pro</p>
                                    <p class="text-[9px] font-bold text-slate-400 italic">Mochila, bastones y linterna
                                        elite</p>
                                </div>
                            </div>
                            <span class="text-xs font-black text-primary italic">+ S/ 120</span>
                        </label>
                        <label
                            class="flex items-center justify-between p-4 bg-white rounded-2xl cursor-pointer border border-transparent hover:border-primary transition-all group">
                            <div class="flex items-center gap-3">
                                <input type="checkbox" class="addon-check w-5 h-5 accent-primary"
                                    onchange="toggleAddon('photo', 75, 'Pack de Fotos & Reel 4K')">
                                <div>
                                    <p class="text-[11px] font-black text-slate-800">Pack Multimeadia 4K</p>
                                    <p class="text-[9px] font-bold text-slate-400 italic">80 fotos editadas + Video
                                        Drone</p>
                                </div>
                            </div>
                            <span class="text-xs font-black text-primary italic">+ S/ 75</span>
                        </label>
                        <label
                            class="flex items-center justify-between p-4 bg-indigo-600 text-white rounded-2xl cursor-pointer border border-transparent hover:scale-105 transition-all group shadow-lg">
                            <div class="flex items-center gap-3">
                                <input type="checkbox" class="addon-check w-5 h-5 accent-accent"
                                    onchange="toggleAddon('guarantee', 49, 'Garant√≠a: Expedici√≥n Protegida')">
                                <div>
                                    <p class="text-[11px] font-black">Garant√≠a: Expedici√≥n Protegida</p>
                                    <p class="text-[9px] font-bold opacity-80 italic">Cancela por clima o salud (100%
                                        Reembolso)</p>
                                </div>
                            </div>
                            <span class="text-xs font-black italic">+ S/ 49</span>
                        </label>
                    </div>
                    <div class="mt-6 flex items-center gap-3 p-4 bg-primary/10 rounded-2xl border border-primary/20">
                        <i class="ri-sparkling-fill text-primary animate-pulse"></i>
                        <p class="text-[9px] font-black text-primary uppercase">¬°Efecto Bundle! Ahorra 15% en
                            adicionales al llevar 2 o m√°s</p>
                    </div>
                </div>

                <!-- RECOMMENDED EQUIPMENT SECTION (V28) -->
                <div id="recommended-equipment-section"
                    class="mt-8 bg-slate-50 p-6 lg:p-8 rounded-[40px] border border-slate-200">
                    <div class="flex items-center gap-3 mb-6">
                        <i class="ri-shopping-bag-3-line text-slate-800 text-xl"></i>
                        <div>
                            <h4 class="font-black text-sm uppercase tracking-widest">Equipo Recomendado</h4>
                            <p class="text-[8px] font-bold text-slate-400 italic">Para esta expedici√≥n</p>
                        </div>
                    </div>
                    <div id="recommended-equipment-list" class="grid grid-cols-1 gap-4">
                        <!-- JS Injection -->
                    </div>
                </div>

                <button id="add-btn" onclick="addToCartFinal()" disabled
                    class="relative z-10 bg-primary px-8 lg:px-12 py-4 lg:py-6 rounded-[24px] font-black uppercase text-[10px] lg:text-xs tracking-widest shadow-2xl opacity-30 cursor-not-allowed hover:scale-105 transition-all">
                    Reservar
                </button>
            </div>
            <!-- Mobile Close -->
            <button onclick="closeModal()"
                class="lg:hidden mt-6 text-center text-[10px] font-black uppercase text-slate-400">Volver al
                mapa</button>
        </div>
    </div>
    </div>

    <!-- CART & CHECKOUT (V20) -->
    <div id="cart-drawer"
        class="fixed top-0 right-0 w-full md:w-[450px] h-full bg-white shadow-3xl z-[2010] transform translate-x-full transition-transform duration-700 p-12 flex flex-col">
        <div class="flex justify-between items-center mb-12">
            <h3 class="text-3xl font-black italic">Mochila</h3>
            <button onclick="toggleCart()"><i class="ri-close-large-line text-2xl"></i></button>
        </div>
        <div class="flex-1 overflow-y-auto space-y-6 no-scrollbar" id="cart-list"></div>

        <!-- UP-SELLING SECTION (V28) -->
        <div id="upsell-container" class="mt-8 pt-8 border-t border-slate-50 hidden">
            <h4 class="text-[10px] font-black text-primary uppercase tracking-widest mb-4 italic">Recomendado para tu
                Expedici√≥n</h4>
            <div id="upsell-list" class="space-y-4">
                <!-- JS Inject -->
            </div>
        </div>
        <div class="pt-8 border-t border-slate-50">
            <div class="flex justify-between items-end mb-10">
                <div>
                    <p class="text-[10px] font-black text-secondary uppercase mb-1 italic">Club Elite -15%
                        OFF</p>
                    <p class="text-[10px] font-black text-slate-400 uppercase">Total Final</p>
                </div>
                <p id="cart-total" class="text-4xl font-black italic leading-none">S/ 0</p>
            </div>
            <button onclick="processPay()"
                class="w-full bg-primary text-white py-6 rounded-3xl font-black uppercase text-xs tracking-widest shadow-2xl">Finalizar
                & Pagar</button>
        </div>
    </div>

    <!-- GLOBAL AI CONCIERGE (V27 INTEGRATION) -->
    <div onclick="toggleAIDrawer()"
        class="fixed bottom-10 right-10 w-16 h-16 bg-primary text-white rounded-3xl shadow-3xl flex items-center justify-center z-[1500] cursor-pointer hover:scale-110 active:scale-95 transition-all animate-bounce-slow">
        <i class="ri-sparkling-2-fill text-2xl"></i>
        <div class="absolute -top-1 -right-1 w-4 h-4 bg-accent rounded-full border-2 border-white animate-pulse">
        </div>
    </div>

    <!-- FOMO NOTIFICATIONS CONTAINER -->
    <div id="fomo-container" class="fixed bottom-32 left-10 z-[1500] pointer-events-none space-y-4"></div>

    <div id="ai-drawer"
        class="fixed bottom-32 right-10 w-96 h-[550px] bg-white rounded-[48px] shadow-3xl border border-slate-100 z-[1505] hidden flex flex-col overflow-hidden animate-slideUp">
        <div class="p-8 bg-primary text-white flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center"><i
                        class="ri-robot-2-line text-xl"></i></div>
                <div>
                    <h4 class="font-black text-xs uppercase tracking-widest">Lifextreme AI</h4>
                    <p class="text-[9px] font-bold opacity-60 italic">Online ‚Ä¢ Soporte T√°ctico</p>
                </div>
            </div>
            <button onclick="toggleAIDrawer()" class="opacity-50 hover:opacity-100 transition-all"><i
                    class="ri-close-large-line text-xl"></i></button>
        </div>

        <div class="flex-1 p-8 overflow-y-auto space-y-6 no-scrollbar bg-slate-50/30" id="ai-messages">
            <div class="flex gap-3">
                <div class="w-8 h-8 bg-indigo-50 rounded-lg flex items-center justify-center text-primary shrink-0">
                    <i class="ri-sparkling-fill"></i>
                </div>
                <div class="bg-white p-4 rounded-2xl rounded-tl-none border border-slate-100 shadow-sm">
                    <p class="text-[11px] font-bold text-slate-600 leading-relaxed italic">¬°Hola Alex! Soy
                        tu Concierge
                        T√°ctico. Veo que est√°s explorando nuestros nuevos destinos regionales. ¬øTe gustar√≠a
                        conocer el
                        itinerario de Iquitos o las competencias en Cusco?</p>
                </div>
            </div>
        </div>

        <div class="p-6 bg-white border-t border-slate-50">
            <div class="flex gap-3 bg-slate-50 p-2 rounded-2xl border border-slate-100">
                <input type="text" id="ai-input" onkeypress="if(event.key=='Enter') sendAIMessage()"
                    placeholder="Consulta tu expedici√≥n..."
                    class="flex-1 bg-transparent px-4 py-2 text-[11px] font-bold outline-none">
                <button onclick="sendAIMessage()"
                    class="w-10 h-10 bg-slate-900 text-white rounded-xl flex items-center justify-center hover:bg-primary transition-all shadow-lg"><i
                        class="ri-send-plane-2-fill"></i></button>
            </div>
        </div>
    </div>

    <!-- MODAL: ADVENTURE QUIZ (V28) -->
    <div id="quiz-modal"
        class="hidden fixed inset-0 z-[2020] bg-slate-900/60 backdrop-blur-md flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-2xl rounded-[48px] overflow-hidden shadow-3xl p-8 lg:p-16 relative">
            <button onclick="closeQuiz()"
                class="absolute top-8 right-8 text-slate-400 hover:text-slate-900 transition-all"><i
                    class="ri-close-large-line text-xl"></i></button>

            <div id="quiz-step-1" class="quiz-step space-y-8">
                <div class="text-center">
                    <span class="text-primary font-black text-[10px] uppercase tracking-[0.4em]">Paso 01/03</span>
                    <h3 class="text-3xl font-black italic mt-4">¬øCu√°l es tu nivel t√°ctico?</h3>
                </div>
                <div class="grid grid-cols-1 gap-4">
                    <button onclick="nextQuizStep(2, 'novato')"
                        class="p-6 bg-slate-50 rounded-3xl border border-slate-100 hover:border-primary hover:bg-white transition-all text-left group">
                        <p class="font-black text-slate-800 italic">Novato (Entusiasta)</p>
                        <p class="text-[10px] font-bold text-slate-400 italic">Busco mi primera gran experiencia</p>
                    </button>
                    <button onclick="nextQuizStep(2, 'intermedio')"
                        class="p-6 bg-slate-50 rounded-3xl border border-slate-100 hover:border-primary hover:bg-white transition-all text-left group">
                        <p class="font-black text-slate-800 italic">Intermedio (Explorador)</p>
                        <p class="text-[10px] font-bold text-slate-400 italic">He realizado trekkings de varios d√≠as</p>
                    </button>
                    <button onclick="nextQuizStep(2, 'elite')"
                        class="p-6 bg-indigo-50 rounded-3xl border border-indigo-100 hover:border-primary hover:bg-white transition-all text-left group">
                        <p class="font-black text-primary italic">Elite (T√©cnico)</p>
                        <p class="text-[10px] font-bold text-indigo-400 italic">Domino equipo y condiciones extremas</p>
                    </button>
                </div>
            </div>

            <div id="quiz-step-2" class="quiz-step hidden space-y-8">
                <div class="text-center">
                    <span class="text-primary font-black text-[10px] uppercase tracking-[0.4em]">Paso 02/03</span>
                    <h3 class="text-3xl font-black italic mt-4">¬øQu√© entorno te llama?</h3>
                </div>
                <div class="grid grid-cols-1 gap-4">
                    <button onclick="nextQuizStep(3, 'monta√±a')"
                        class="p-6 bg-slate-50 rounded-3xl border border-slate-100 hover:border-primary hover:bg-white transition-all flex items-center gap-4">
                        <i class="ri-landscape-line text-2xl text-primary"></i>
                        <span class="font-black text-slate-800 italic">Monta√±a & Glaciares</span>
                    </button>
                    <button onclick="nextQuizStep(3, 'selva')"
                        class="p-6 bg-slate-50 rounded-3xl border border-slate-100 hover:border-primary hover:bg-white transition-all flex items-center gap-4">
                        <i class="ri-cactus-line text-2xl text-primary"></i>
                        <span class="font-black text-slate-800 italic">Selva Profunda</span>
                    </button>
                    <button onclick="nextQuizStep(3, 'costa')"
                        class="p-6 bg-slate-50 rounded-3xl border border-slate-100 hover:border-primary hover:bg-white transition-all flex items-center gap-4">
                        <i class="ri-temp-hot-line text-2xl text-primary"></i>
                        <span class="font-black text-slate-800 italic">Costa & Desierto</span>
                    </button>
                </div>
            </div>

            <div id="quiz-step-3" class="quiz-step hidden space-y-8">
                <div class="text-center">
                    <span class="text-primary font-black text-[10px] uppercase tracking-[0.4em]">Paso 03/03</span>
                    <h3 class="text-3xl font-black italic mt-4">¬°Casi listo! <br>¬øD√≥nde te enviamos tu cup√≥n?</h3>
                    <p class="text-[11px] font-bold text-slate-500 mt-4">Te daremos un -10% de descuento y tu
                        recomendaci√≥n ideal.</p>
                </div>
                <div class="space-y-4">
                    <input type="email" id="quiz-email" placeholder="tu@email.com"
                        class="w-full p-6 bg-slate-50 rounded-3xl border border-slate-100 outline-none font-black text-sm">
                    <button onclick="finishQuiz()"
                        class="w-full bg-primary text-white py-6 rounded-3xl font-black uppercase text-xs tracking-widest shadow-2xl hover:bg-slate-900 transition-all">Obtener
                        Mi Descuento</button>
                </div>
            </div>

            <div id="quiz-result" class="quiz-step hidden space-y-8 text-center">
                <div
                    class="w-20 h-20 bg-secondary/10 text-secondary rounded-full flex items-center justify-center mx-auto mb-6">
                    <i class="ri-checkbox-circle-fill text-5xl"></i>
                </div>
                <h3 class="text-3xl font-black italic">¬°Perfecto, Alex!</h3>
                <p class="text-slate-600 font-bold mb-8">Seg√∫n tus respuestas, tu aventura ideal es el <span
                        class="text-primary italic" id="recommended-tour">...</span></p>

                <div class="bg-slate-900 p-8 rounded-[32px] text-white relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-24 h-24 bg-primary blur-[40px] opacity-40"></div>
                    <p class="text-[10px] font-black tracking-[0.4em] uppercase mb-4">Tu Cup√≥n Exclusivo</p>
                    <p class="text-4xl font-black italic text-accent leading-none mb-2">EXPLORE10</p>
                    <p class="text-[9px] font-black opacity-50 uppercase">V√ÅLIDO POR 24 HORAS</p>
                </div>
                <button onclick="closeQuiz()"
                    class="text-[10px] font-black uppercase text-slate-400 tracking-widest hover:text-slate-900 transition-all">Cerrar
                    y Ver Destinos</button>
            </div>
        </div>
    </div>

    <!-- MODAL: FEEDBACK POST-EXPEDICI\u00d3N (V28) -->
    <div id="feedback-modal"
        class="hidden fixed inset-0 z-[2020] bg-slate-900/60 backdrop-blur-md flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-[48px] overflow-hidden shadow-3xl p-8 lg:p-12 relative">
            <button onclick="closeFeedbackModal()"
                class="absolute top-8 right-8 text-slate-400 hover:text-slate-900 transition-all"><i
                    class="ri-close-large-line text-xl"></i></button>

            <div class="text-center mb-8">
                <div
                    class="w-16 h-16 bg-primary/10 text-primary rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <i class="ri-feedback-fill text-3xl"></i>
                </div>
                <h3 class="text-2xl font-black italic mb-2">\u00bfC\u00f3mo estuvo tu expedici\u00f3n?</h3>
                <p id="feedback-tour-name" class="text-[10px] font-black text-slate-400 uppercase tracking-widest"></p>
            </div>

            <div class="space-y-6 mb-8">
                <div>
                    <p class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-3">Gu\u00eda</p>
                    <div class="flex gap-2 justify-center" id="rating-guide">
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('guide', 1)"></i>
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('guide', 2)"></i>
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('guide', 3)"></i>
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('guide', 4)"></i>
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('guide', 5)"></i>
                    </div>
                </div>
                <div>
                    <p class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-3">Equipo</p>
                    <div class="flex gap-2 justify-center" id="rating-equipment">
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('equipment', 1)"></i>
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('equipment', 2)"></i>
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('equipment', 3)"></i>
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('equipment', 4)"></i>
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('equipment', 5)"></i>
                    </div>
                </div>
                <div>
                    <p class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-3">Dificultad</p>
                    <div class="flex gap-2 justify-center" id="rating-difficulty">
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('difficulty', 1)"></i>
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('difficulty', 2)"></i>
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('difficulty', 3)"></i>
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('difficulty', 4)"></i>
                        <i class="ri-star-line text-3xl text-slate-200 cursor-pointer hover:text-accent transition-all"
                            onclick="setRating('difficulty', 5)"></i>
                    </div>
                </div>
            </div>

            <button onclick="submitFeedback()"
                class="w-full bg-primary text-white py-6 rounded-3xl font-black uppercase text-xs tracking-widest shadow-2xl hover:bg-slate-900 transition-all">Enviar
                Feedback</button>
        </div>
    </div>

    <!-- MODAL: KIT BUILDER (V28) -->
    <div id="kit-builder-modal"
        class="hidden fixed inset-0 z-[2020] bg-slate-900/60 backdrop-blur-md flex items-center justify-center p-4">
        <div
            class="bg-white w-full max-w-4xl rounded-[48px] overflow-hidden shadow-3xl p-8 lg:p-12 relative max-h-[90vh] overflow-y-auto">
            <button onclick="closeKitBuilder()"
                class="absolute top-8 right-8 text-slate-400 hover:text-slate-900 transition-all z-10"><i
                    class="ri-close-large-line text-xl"></i></button>

            <!-- Step 1: Destination Selection -->
            <div id="kit-step-1" class="kit-step">
                <div class="text-center mb-10">
                    <div
                        class="w-20 h-20 bg-primary/10 text-primary rounded-3xl flex items-center justify-center mx-auto mb-6">
                        <i class="ri-shopping-bag-3-fill text-4xl"></i>
                    </div>
                    <h3 class="text-3xl font-black italic mb-3">Arma tu Kit Personalizado</h3>
                    <p class="text-[11px] font-bold text-slate-500">Selecciona el tipo de aventura y armamos el kit
                        perfecto con 20% de descuento</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <button onclick="buildKit('Alta Monta√±a')"
                        class="p-8 bg-gradient-to-br from-indigo-50 to-white rounded-3xl border-2 border-indigo-100 hover:border-primary transition-all text-left group">
                        <i class="ri-landscape-line text-4xl text-primary mb-4 block"></i>
                        <h4 class="text-xl font-black italic mb-2">Alta Monta√±a</h4>
                        <p class="text-[10px] font-bold text-slate-500">Picos, glaciares y alta altitud</p>
                    </button>
                    <button onclick="buildKit('Selva')"
                        class="p-8 bg-gradient-to-br from-green-50 to-white rounded-3xl border-2 border-green-100 hover:border-primary transition-all text-left group">
                        <i class="ri-cactus-line text-4xl text-green-600 mb-4 block"></i>
                        <h4 class="text-xl font-black italic mb-2">Selva</h4>
                        <p class="text-[10px] font-bold text-slate-500">Amazon√≠a y jungle profundo</p>
                    </button>
                    <button onclick="buildKit('Costa & Desierto')"
                        class="p-8 bg-gradient-to-br from-orange-50 to-white rounded-3xl border-2 border-orange-100 hover:border-primary transition-all text-left group">
                        <i class="ri-temp-hot-line text-4xl text-orange-500 mb-4 block"></i>
                        <h4 class="text-xl font-black italic mb-2">Costa & Desierto</h4>
                        <p class="text-[10px] font-bold text-slate-500">Dunas, playas y calor extremo</p>
                    </button>
                    <button onclick="buildKit('Trekking General')"
                        class="p-8 bg-gradient-to-br from-slate-50 to-white rounded-3xl border-2 border-slate-100 hover:border-primary transition-all text-left group">
                        <i class="ri-footprint-line text-4xl text-slate-600 mb-4 block"></i>
                        <h4 class="text-xl font-black italic mb-2">Trekking General</h4>
                        <p class="text-[10px] font-bold text-slate-500">Vers√°til para cualquier ruta</p>
                    </button>
                </div>
            </div>

            <!-- Step 2: Kit Preview & Checkout -->
            <div id="kit-step-2" class="kit-step hidden">
                <div class="mb-8">
                    <button onclick="showKitStep(1)"
                        class="text-[10px] font-black text-slate-400 hover:text-primary uppercase tracking-widest flex items-center gap-2">
                        <i class="ri-arrow-left-line"></i> Cambiar Destino
                    </button>
                </div>

                <div class="flex items-center gap-4 mb-8">
                    <div class="w-16 h-16 bg-primary/10 text-primary rounded-2xl flex items-center justify-center">
                        <i id="kit-icon" class="text-3xl"></i>
                    </div>
                    <div>
                        <h3 id="kit-name" class="text-2xl font-black italic"></h3>
                        <p id="kit-description" class="text-[10px] font-bold text-slate-500"></p>
                    </div>
                </div>

                <div class="bg-slate-50 p-8 rounded-3xl mb-8">
                    <h4 class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-6">Contenido del Kit
                    </h4>
                    <div id="kit-items-list" class="space-y-4">
                        <!-- JS Injection -->
                    </div>
                </div>

                <div class="bg-slate-900 p-8 rounded-3xl text-white mb-8">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-[10px] font-black uppercase tracking-widest opacity-60">Precio
                            Individual</span>
                        <span id="kit-original-price" class="text-lg font-black line-through opacity-60"></span>
                    </div>
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="text-[10px] font-black uppercase tracking-widest text-accent">Precio Kit
                                (-20%)</span>
                            <p class="text-[8px] font-bold opacity-60 italic">Ahorro garantizado</p>
                        </div>
                        <span id="kit-final-price" class="text-4xl font-black italic"></span>
                    </div>
                </div>

                <button onclick="addKitToCart()"
                    class="w-full bg-primary text-white py-6 rounded-3xl font-black uppercase text-xs tracking-widest shadow-2xl hover:bg-slate-900 transition-all">
                    <i class="ri-shopping-cart-2-fill"></i> Agregar Kit Completo
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL: STRIPE CHECKOUT (V28) -->
    <div id="stripe-checkout-modal"
        class="hidden fixed inset-0 z-[2030] bg-slate-900/80 backdrop-blur-md flex items-center justify-center p-4">
        <div
            class="bg-white w-full max-w-2xl rounded-[48px] overflow-hidden shadow-3xl relative max-h-[95vh] overflow-y-auto">
            <button onclick="closeStripeCheckout()"
                class="absolute top-6 right-6 text-slate-400 hover:text-slate-900 transition-all z-10">
                <i class="ri-close-large-line text-2xl"></i>
            </button>

            <!-- Checkout Header -->
            <div class="bg-gradient-to-br from-primary to-indigo-700 p-8 text-white">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center">
                        <i class="ri-secure-payment-line text-3xl"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-black italic">Checkout Seguro</h3>
                        <p class="text-[10px] font-bold text-white/80 uppercase tracking-widest">Powered by Stripe</p>
                    </div>
                </div>
            </div>

            <div class="p-8 lg:p-12">
                <!-- Order Summary -->
                <div class="bg-slate-50 p-6 rounded-3xl mb-8">
                    <h4 class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-6">Resumen de tu
                        Reserva</h4>
                    <div id="stripe-order-items" class="space-y-4 mb-6">
                        <!-- JS Injection -->
                    </div>
                    <div class="border-t border-slate-200 pt-4 flex justify-between items-center">
                        <span class="text-sm font-black text-slate-600 uppercase">Total a Pagar</span>
                        <span id="stripe-total-amount" class="text-3xl font-black italic text-primary"></span>
                    </div>
                </div>

                <!-- Customer Information -->
                <form id="stripe-payment-form">
                    <div class="mb-8">
                        <h4 class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-6">Tus Datos</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label
                                    class="text-[9px] font-black text-slate-500 uppercase tracking-widest block mb-2">Nombre
                                    Completo</label>
                                <input type="text" id="customer-name" required
                                    class="w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 outline-none font-bold text-sm focus:border-primary transition-all">
                            </div>
                            <div>
                                <label
                                    class="text-[9px] font-black text-slate-500 uppercase tracking-widest block mb-2">Email</label>
                                <input type="email" id="customer-email" required
                                    class="w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 outline-none font-bold text-sm focus:border-primary transition-all">
                            </div>
                            <div class="md:col-span-2">
                                <label
                                    class="text-[9px] font-black text-slate-500 uppercase tracking-widest block mb-2">Tel√©fono</label>
                                <input type="tel" id="customer-phone" required placeholder="+51 999 999 999"
                                    class="w-full p-4 bg-slate-50 rounded-2xl border border-slate-200 outline-none font-bold text-sm focus:border-primary transition-all">
                            </div>
                        </div>
                    </div>

                    <!-- Stripe Card Element -->
                    <div class="mb-8">
                        <h4 class="text-[10px] font-black text-slate-800 uppercase tracking-widest mb-6">Informaci√≥n de
                            Pago</h4>
                        <div id="card-element" class="p-4 bg-slate-50 rounded-2xl border border-slate-200">
                            <!-- Stripe Card Element will be inserted here -->
                        </div>
                        <div id="card-errors" class="text-red-500 text-xs font-bold mt-2"></div>
                    </div>

                    <!-- Security Badges -->
                    <div class="flex items-center gap-4 mb-8 p-4 bg-green-50 rounded-2xl border border-green-100">
                        <i class="ri-shield-check-fill text-green-600 text-2xl"></i>
                        <div>
                            <p class="text-[10px] font-black text-green-800 uppercase tracking-widest">Pago 100% Seguro
                            </p>
                            <p class="text-[8px] font-bold text-green-600">Encriptaci√≥n SSL de nivel bancario ‚Ä¢ PCI DSS
                                Compliant</p>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" id="stripe-submit-button"
                        class="w-full bg-primary text-white py-6 rounded-3xl font-black uppercase text-xs tracking-widest shadow-2xl hover:bg-slate-900 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                        <span id="button-text">Pagar <span id="button-amount"></span></span>
                        <span id="button-spinner" class="hidden">
                            <i class="ri-loader-4-line animate-spin"></i> Procesando...
                        </span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL: ORDER CONFIRMATION -->
    <div id="order-confirmation-modal"
        class="hidden fixed inset-0 z-[2040] bg-slate-900/80 backdrop-blur-md flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-[48px] overflow-hidden shadow-3xl p-8 lg:p-12 text-center">
            <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="ri-checkbox-circle-fill text-green-600 text-6xl"></i>
            </div>
            <h3 class="text-3xl font-black italic mb-3">¬°Pago Exitoso!</h3>
            <p class="text-slate-600 font-bold mb-8">Tu reserva ha sido confirmada</p>

            <div class="bg-slate-50 p-6 rounded-3xl mb-8">
                <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-2">N√∫mero de Orden</p>
                <p id="order-number" class="text-2xl font-black italic text-primary mb-4"></p>
                <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-2">Monto Pagado</p>
                <p id="order-amount" class="text-3xl font-black italic"></p>
            </div>

            <p class="text-xs font-bold text-slate-500 mb-8">Hemos enviado la confirmaci√≥n a tu email con todos los
                detalles de tu expedici√≥n.</p>

            <button onclick="closeOrderConfirmation()"
                class="w-full bg-primary text-white py-5 rounded-3xl font-black uppercase text-xs tracking-widest hover:bg-slate-900 transition-all">
                Continuar Explorando
            </button>
        </div>
    </div>

    <style>
        @keyframes bounce-slow {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .animate-bounce-slow {
            animation: bounce-slow 3s infinite ease-in-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .animate-slideUp {
            animation: slideUp 0.5s cubic-bezier(0.23, 1, 0.32, 1);
        }
    </style>

    <script>
        // --- DATA ---
        const tours = [
            // CUSCO (5)
            {
                id: 1,
                title: 'Inca Trail 4D',
                dept: 'Cusco',
                price: 2450,
                duration: '4 d√≠as',
                difficulty: 'Alta',
                img: 'https://images.unsplash.com/photo-1587547131116-a0655a526190',
                detail: 'La ruta m√°s ic√≥nica del mundo hacia Machu Picchu.',
                genInfo: {
                    cancelPolicy: 'Esta actividad no es reembolsable',
                    duration: '4 d√≠as',
                    availability: 'Comprueba la disponibilidad para ver los horarios de inicio',
                    guide: 'Ingl√©s, Espa√±ol',
                    groupSize: 'M√°ximo 9 participantes'
                },
                whatYouDo: [
                    'Bicicleta en Abra M√°laga a 4,316 metros',
                    'Aprende y participa en el tostado de caf√© artesanal',
                    'Rel√°jate en las relajantes aguas termales de Cocalmayo',
                    'Explora la ciudadela de Machu Picchu con gu√≠a experto'
                ],
                fullItinerary: [
                    {
                        day: 1,
                        desc: 'El D√≠a 1 comienza con un servicio de recogida a las 6:00 AM en la Plaza Mayor de Cuzco. Viaja a trav√©s del Valle Sagrado hasta el paso de Abra M√°laga (4,316m). Se inicia un descenso en bicicleta de unas 3 horas (50 km) por zonas de puna y bosque nuboso hasta las ruinas de Huaman Marq\'a. Pasaremos la noche en una casa ecol√≥gica en Pispitayoc con cena incluida.'
                    },
                    {
                        day: 2,
                        desc: 'El segundo d√≠a comienza con un desayuno y clases de tostado de caf√©. Caminaremos por parte del Camino Inca (Qhapaq √ëan) con vistas de aves y plantaciones frutales. Llegaremos al mirador de Huancarcasa (1,750m) para vistas panor√°micas. El descenso nos lleva a Qellomayo para almorzar y finalmente a las termas de Cocalmayo antes de dormir en Santa Teresa.'
                    },
                    {
                        day: 3,
                        desc: 'Caminata de 3 horas por plantaciones de caf√© y coca hasta llegar a Hidroel√©ctrica (1,900m). Despu√©s del almuerzo, seguimos 3 horas m√°s por la v√≠a del tren hasta Aguas Calientes (1,950m). Tarde libre para ocio y preparaci√≥n para la ascensi√≥n final a Machu Picchu.'
                    },
                    {
                        day: 4,
                        desc: 'Subida temprana a las 4:00 AM hacia Machu Picchu (2,400m). Tour guiado de 2 horas por los sectores m√°s significativos de la ciudadela. Tiempo libre de exploraci√≥n antes de retornar a Aguas Calientes para el tren a Ollantaytambo y bus de retorno a Cusco.'
                    }
                ],
                inc: [
                    'Briefing el d√≠a anterior',
                    'Recogida en el centro de Cusco (Plaza de Armas)',
                    'Transporte Cusco - Abra M√°laga - Santa Mar√≠a',
                    'Bicicleta Kona, coderas, rodilleras, guantes, casco',
                    '3 desayunos / 3 almuerzos / 3 cenas',
                    'Tickets de entrada a Machu Picchu',
                    'Gu√≠a profesional biling√ºe (ingl√©s-espa√±ol)',
                    'Bus de retorno Ollantaytambo - Cusco'
                ],
                notSuitable: ['Embarazadas', 'Personas con problemas de espalda', 'Personas en silla de ruedas'],
                meetingPoint: 'Plaza Mayor de Cuzco (El gu√≠a tendr√° la chaqueta oficial Lifextreme)',
                importantInfo: 'Llevar pasaporte o documento de identidad original (se acepta copia)',
                steps: [{ n: 'G', t: 'Cusco Hotel', d: '06:00 AM' }, { n: 'ri-map-pin-2-fill', t: 'Abra M√°laga', d: 'Descenso Bici' }, { n: 'dot', t: 'Machu Picchu', d: 'Final' }]
            },
            {
                id: 2,
                title: 'Salkantay Trek Elite',
                dept: 'Cusco',
                price: 1850,
                duration: '5 d√≠as',
                difficulty: 'Extrema',
                img: 'https://images.unsplash.com/photo-1596395819057-033f7b2c5897',
                detail: 'Ruta alternativa de alta monta√±a por nevados y selva alta.',
                genInfo: {
                    cancelPolicy: 'Reembolso parcial hasta 7 d√≠as antes',
                    duration: '5 d√≠as',
                    availability: 'Salidas diarias confirmadas',
                    guide: 'Ingl√©s, Espa√±ol, Franc√©s',
                    groupSize: 'M√°ximo 12 participantes'
                },
                whatYouDo: [
                    'Ascenso al paso Salkantay a 4,630 metros',
                    'Visita a la Laguna Humantay turquesa',
                    'Caminata por ceja de selva y plantaciones',
                    'Llegada triunfal a Machu Picchu'
                ],
                fullItinerary: [
                    { day: 1, desc: 'Recogida en Cusco y viaje a Mollepata. Caminata de ascenso hacia Soraypampa con vistas del nevado Humantay. Visita a la laguna Humantay por la tarde.' },
                    { day: 2, desc: 'El d√≠a m√°s dif√≠cil: ascenso al Paso Salkantay (4,630m). Vistas espectaculares de la cordillera Vilcabamba antes de descender hacia Chaullay.' },
                    { day: 3, desc: 'Caminata por la selva alta (ceja de selva). Veremos cascadas, aves y plantaciones de caf√© y frutas tropicales. Noche en La Playa o Lucmabamba.' },
                    { day: 4, desc: 'Ascenso hacia Llactapata para una vista √∫nica de Machu Picchu desde la distancia. Descenso a Hidroel√©ctrica y caminata final a Aguas Calientes.' },
                    { day: 5, desc: 'Exploraci√≥n completa de Machu Picchu al amanecer. Retorno a Cusco por la tarde en tren y bus.' }
                ],
                inc: [
                    'Recogida en hotel',
                    'Gu√≠a profesional especializado en monta√±a',
                    'Cocinero y asistentes especializados',
                    'Caballos para equipo y 7kg personales',
                    '4 desayunos / 4 almuerzos / 4 cenas',
                    'Equipo de campamento de alta monta√±a',
                    'Ticket de entrada a Machu Picchu',
                    'Tren de retorno y bus a Cusco'
                ],
                notSuitable: ['Menores de 12 a√±os', 'Personas con asma severa', 'Problemas de rodilla'],
                meetingPoint: 'Recepci√≥n de su hotel en Cusco (04:30 AM)',
                importantInfo: 'Llevar ropa t√©rmica, bloqueador solar y calzado de trekking ya usado (break-in).',
                steps: [{ n: 'G', t: 'Mollepata', d: 'Inicio' }, { n: 'dot', t: 'Machu Picchu', d: 'Final' }]
            },
            { id: 3, title: 'Vinicunca Speed Run', dept: 'Cusco', price: 450, duration: '1 d√≠a', difficulty: 'Media-Alta', img: 'https://images.unsplash.com/photo-1547483238-2c6036746654', detail: 'Ascenso t√°ctico a la Monta√±a de 7 Colores.', whatYouDo: ['Vistas 5,200m', 'Fotos Paisaj√≠sticas'], steps: [{ n: 'G', t: 'Cusco', d: '04:00 AM' }, { n: 'dot', t: 'Cusco', d: 'Retorno' }], inc: ['Transporte', 'Ox√≠geno'] },
            { id: 4, title: 'Choquequirao Expedition', dept: 'Cusco', price: 3200, duration: '4 d√≠as', difficulty: 'Experto', img: 'https://images.unsplash.com/photo-1583032353423-04fd96ef2211', detail: 'La verdadera ciudad perdida de los Incas.', whatYouDo: ['Ca√±√≥n del Apur√≠mac', 'Ruinas V√≠ctimas'], steps: [{ n: 'G', t: 'Capuliyoc', d: 'Inicio' }, { n: 'dot', t: 'Cachora', d: 'Retorno' }], inc: ['Arrieros', 'Kit Survival'] },
            { id: 5, title: 'Ausangate Glaciar Challenge', dept: 'Cusco', price: 2100, duration: '6 d√≠as', difficulty: 'T√©cnica', img: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b', detail: 'Alta ruta alrededor del Apu Ausangate.', whatYouDo: ['Siete Lagunas', 'Pases Nevados'], steps: [{ n: 'G', t: 'Tinqui', d: 'Base' }, { n: 'dot', t: 'Tinqui', d: 'Retorno' }], inc: ['Gu√≠a Monta√±a', 'Catering'] },

            // HUARAZ (5)
            { id: 6, title: 'Santa Cruz Trek 4D', dept: 'Huaraz', price: 1200, duration: '4 d√≠as', difficulty: 'Media', img: 'https://images.unsplash.com/photo-1544198365-f5d60b6d8190', detail: 'El circuito cl√°sico de la Cordillera Blanca.', whatYouDo: ['Paso Punta Uni√≥n', 'Nevado Taulliraju'], steps: [{ n: 'G', t: 'Cashapampa', d: 'Inicio' }, { n: 'dot', t: 'Vaqueria', d: 'Final' }], inc: ['Burros', 'Cocinero'] },
            { id: 7, title: 'Huascar√°n Summit View', dept: 'Huaraz', price: 4500, duration: '7 d√≠as', difficulty: 'Experto', img: 'https://images.unsplash.com/photo-1522163182402-834f60b58e26', detail: 'Ascenso t√©cnico por el glaciar m√°s alto.', whatYouDo: ['Alta monta√±a', 'Escalada en hielo'], steps: [{ n: 'G', t: 'Musho', d: 'Base' }, { n: 'dot', t: 'Cumbre', d: 'Cumbre' }], inc: ['Gu√≠a UIAGM', 'Cuerdas'] },
            { id: 8, title: 'Laguna 69 Ultra', dept: 'Huaraz', price: 350, duration: '1 d√≠a', difficulty: 'Alta', img: 'https://images.unsplash.com/photo-1527004013197-29007328905b', detail: 'Aclimataci√≥n extrema a 4,600m.', whatYouDo: ['Nevado Pisco', 'Laguna Turquesa'], steps: [{ n: 'G', t: 'Cebollapampa', d: 'Ascenso' }, { n: 'dot', t: 'Huaraz', d: 'Descanso' }], inc: ['Almuerzo Box'] },
            { id: 9, title: 'Pastoruri Ice Wall', dept: 'Huaraz', price: 280, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1544198365-f5d60b6d8190', detail: 'Ruta del Cambio Clim√°tico y Puya Raimondi.', whatYouDo: ['Glaciar Pastoruri', 'Pinturas Rupestres'], steps: [{ n: 'G', t: 'Huaraz', d: 'Salida' }, { n: 'dot', t: 'Pastoruri', d: 'Final' }], inc: ['Ticket Parque'] },
            { id: 10, title: 'Ishinca Base Camp', dept: 'Huaraz', price: 1600, duration: '3 d√≠as', difficulty: 'T√©cnica', img: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b', detail: 'Entrenamiento t√©cnico para 6ks.', whatYouDo: ['Entrenamiento Cuerdas', 'Cena Alpina'], steps: [{ n: 'G', t: 'Pashpa', d: 'Caminata' }, { n: 'dot', t: 'Refugio', d: 'Base' }], inc: ['Carpas Alta Monta√±a'] },

            // IQUITOS (5)
            { id: 11, title: 'Pacaya Samiria Safari', dept: 'Iquitos', price: 2800, duration: '5 d√≠as', difficulty: 'Media', img: 'https://images.unsplash.com/photo-1516306580123-e6e52b1b7b5f', detail: 'Vida silvestre profunda en la selva de espejos.', whatYouDo: ['Delfines Rosados', 'Pesca Pira√±a'], steps: [{ n: 'G', t: 'Iquitos', d: 'Nauta' }, { n: 'dot', t: 'Iquitos', d: 'Retorno' }], inc: ['Canoa', 'Lodge'] },
            { id: 12, title: 'Ayahuasca Retreat Pro', dept: 'Iquitos', price: 3500, duration: '7 d√≠as', difficulty: 'Espiritual', img: 'https://images.unsplash.com/photo-1440342359743-84fcb8c21f21', detail: 'Viaje espiritual guiado por maestros Shamanes.', whatYouDo: ['Sesiones sanaci√≥n', 'Dietas selva'], steps: [{ n: 'G', t: 'Maloca', d: 'Inicio' }, { n: 'dot', t: 'Luz', d: 'Cierre' }], inc: ['Gu√≠a Espiritual'] },
            { id: 13, title: 'Monkey Island Boat', dept: 'Iquitos', price: 150, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1540573133985-87b6da6d54a9', detail: 'Rescate de primates en el Amazonas.', whatYouDo: ['Alimentar monos', 'Paseo r√≠o'], steps: [{ n: 'G', t: 'Puerto', d: '09:00 AM' }, { n: 'dot', t: 'Isla', d: 'Visita' }], inc: ['Donaci√≥n'] },
            { id: 14, title: 'Amazon Canopy Walkway', dept: 'Iquitos', price: 650, duration: '1 d√≠a', difficulty: 'Media', img: 'https://images.unsplash.com/photo-1542332213-9b5a5a3fad35', detail: 'Puentes colgantes sobre la copa de los √°rboles.', whatYouDo: ['Observaci√≥n Aves', 'Puentes 35m'], steps: [{ n: 'G', t: 'Lodge', d: 'Ascenso' }, { n: 'dot', t: 'Mirador', d: 'Sunset' }], inc: ['Arn√©s'] },
            { id: 15, title: 'Survival Jungle Camp', dept: 'Iquitos', price: 1950, duration: '3 d√≠as', difficulty: 'Alta', img: 'https://images.unsplash.com/photo-1516306580123-e6e52b1b7b5f', detail: 'Aprende a vivir de la selva virgen.', whatYouDo: ['Construir refugios', 'Fuego'], steps: [{ n: 'G', t: 'Selva', d: 'Drop off' }, { n: 'dot', t: 'Selva', d: 'Pick up' }], inc: ['Machete'] },

            // PIURA (5)
            { id: 16, title: 'Kitesurf M√°ncora Pro', dept: 'Piura', price: 850, duration: '3 d√≠as', difficulty: 'Media', img: 'https://images.unsplash.com/photo-1534067783941-51c9c23ecefd', detail: 'Vuela sobre las olas del Pac√≠fico norte.', whatYouDo: ['Clases Kitesurf', 'Downwind'], steps: [{ n: 'G', t: 'Beach', d: 'Viento' }, { n: 'dot', t: 'Sunset', d: 'Bar' }], inc: ['Equipo'] },
            { id: 17, title: 'Nado Polinizador Tortugas', dept: 'Piura', price: 120, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1544551763-47a0159f963f', detail: 'Nado respetuoso con tortugas en El √ëuro.', whatYouDo: ['Snorkel', 'Fotos Marinas'], steps: [{ n: 'G', t: 'Muelle', d: 'Embarque' }, { n: 'dot', t: 'Mar', d: 'Nado' }], inc: ['Chaleco'] },
            { id: 18, title: 'Cabo Blanco Surf Quest', dept: 'Piura', price: 300, duration: '1 d√≠a', difficulty: 'Media', img: 'https://images.unsplash.com/photo-1439066615861-d1af74d74000', detail: 'La mejor ola izquierda del Per√∫.', whatYouDo: ['Tubos √©picos', 'Pesca altura'], steps: [{ n: 'G', t: 'Caleta', d: '06:00 AM' }, { n: 'dot', t: 'Pipeline', d: 'Final' }], inc: ['Board'] },
            { id: 19, title: 'Manglares Tumbes Safari', dept: 'Piura', price: 450, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1518495973542-4542c06a5843', detail: 'Navegaci√≥n por ecosistemas √∫nicos.', whatYouDo: ['Cocodrilos', 'Cangrejo Rojo'], steps: [{ n: 'G', t: 'Zarumilla', d: 'Bote' }, { n: 'dot', t: 'Frontera', d: 'Retorno' }], inc: ['Degustaci√≥n'] },
            { id: 20, title: 'Whale Watching Season', dept: 'Piura', price: 250, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1454991727061-be514eae86f7', detail: 'Observaci√≥n de ballenas jorobadas.', whatYouDo: ['Avistamiento', 'Hidr√≥fonos'], steps: [{ n: 'G', t: '√ìrganos', d: 'Salida' }, { n: 'dot', t: 'Alta Mar', d: 'Retorno' }], inc: ['Biolog√≠a'] },

            // ICA (5)
            { id: 21, title: 'Sandboarding Huacachina', dept: 'ICA', price: 180, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1506461883276-594a12b11cf3', detail: 'Adrenalina pura en las dunas m√°s altas.', whatYouDo: ['Buggies 4x4', 'Sandboard Fast'], steps: [{ n: 'G', t: 'Oasis', d: 'Briefing' }, { n: 'dot', t: 'Dunas', d: 'Sunset' }], inc: ['Sandboard'] },
            { id: 22, title: 'Paracas Res. Satelital', dept: 'ICA', price: 350, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1610484826917-0f101a7bf7f4', detail: 'Expedici√≥n terrestre a la Reserva Nacional.', whatYouDo: ['Playa Roja', 'F√≥siles'], steps: [{ n: 'G', t: 'Paracas', d: 'Pickup' }, { n: 'dot', t: 'Catedral', d: 'Final' }], inc: ['SUV 4x4'] },
            { id: 23, title: 'Islas Ballestas Boat', dept: 'ICA', price: 80, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1544551763-47a0159f963f', detail: 'El peque√±o Gal√°pagos de Per√∫.', whatYouDo: ['Leones Marinos', 'Candelabro'], steps: [{ n: 'G', t: 'Puerto', d: 'Zarpe' }, { n: 'dot', t: 'Mar', d: 'Puerto' }], inc: ['Gu√≠a RNP'] },
            { id: 24, title: 'Nazca Flight Experience', dept: 'ICA', price: 650, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1540304453527-62f9791029c1', detail: 'Vuelo sobre los misteriosos geoglifos.', whatYouDo: ['Avioneta CESSNA', 'L√≠neas Nazca'], steps: [{ n: 'G', t: 'Aer√≥dromo', d: 'Check-in' }, { n: 'dot', t: 'Nazca', d: 'Vuelo' }], inc: ['Impuestos'] },
            { id: 25, title: 'Vi√±edo Elite Tasting', dept: 'ICA', price: 220, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1506377247377-2a5b3b0ca3ef', detail: 'Visita t√©cnica a bodegas de Pisco.', whatYouDo: ['Cata Maridaje', 'Destiler√≠a'], steps: [{ n: 'G', t: 'Ica', d: 'Ingreso' }, { n: 'dot', t: 'Cata', d: 'Final' }], inc: ['Vino/Pisco'] },

            // PUNO (5)
            { id: 26, title: 'Titicaca Kayak Quest', dept: 'Puno', price: 150, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1544551763-47a0159f963f', detail: 'Rema por el lago navegable m√°s alto.', whatYouDo: ['Kayak Uros', 'Amanecer Lago'], steps: [{ n: 'G', t: 'Puno', d: 'Remos' }, { n: 'dot', t: 'Uros', d: 'Base' }], inc: ['Kayak'] },
            { id: 27, title: 'Taquile Island Hike', dept: 'Puno', price: 120, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1516306580123-e6e52b1b7b5f', detail: 'Tradici√≥n textil en medio del lago.', whatYouDo: ['Senderos Incas', 'Tejedores'], steps: [{ n: 'G', t: 'Muelle', d: 'Bote' }, { n: 'dot', t: 'Isla', d: 'Retorno' }], inc: ['Almuerzo Corrientilla'] },
            { id: 28, title: 'Sillustani Necropolis', dept: 'Puno', price: 90, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1587547131116-a0655a526190', detail: 'Chullpas funerarias de la cultura Qolla.', whatYouDo: ['Torres Piedra', 'Lago Umayo'], steps: [{ n: 'G', t: 'Puno', d: 'Check' }, { n: 'dot', t: 'Sillustani', d: 'Final' }], inc: ['Entrada'] },
            { id: 29, title: 'Amantani Overnight', dept: 'Puno', price: 400, duration: '2 d√≠as', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1440342359743-84fcb8c21f21', detail: 'Duerme en la casa de una familia local.', whatYouDo: ['Pachamama', 'Ceremonia'], steps: [{ n: 'G', t: 'Puno', d: 'Bote' }, { n: 'dot', t: 'Amantani', d: 'Noche' }], inc: ['Hospedaje'] },
            { id: 30, title: 'Puerta Aramu Muru', dept: 'Puno', price: 110, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1583032353423-04fd96ef2211', detail: 'El portal interdimensional de Hayu Marca.', whatYouDo: ['Meditaci√≥n', 'Trekking'], steps: [{ n: 'G', t: 'Chucuito', d: 'Viaje' }, { n: 'dot', t: 'Portal', d: 'Final' }], inc: ['Shaman'] },

            // AREQUIPA (5)
            { id: 31, title: 'Colca Canyon Trek 3D', dept: 'Arequipa', price: 850, duration: '3 d√≠as', difficulty: 'Alta', img: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b', detail: 'Uno de los ca√±ones m√°s profundos.', whatYouDo: ['Condores', 'Sangalle'], steps: [{ n: 'G', t: 'Chivay', d: 'Inicio' }, { n: 'dot', t: 'Cabanaconde', d: 'Retorno' }], inc: ['Mulas'] },
            { id: 32, title: 'Misti Volcano Ascent', dept: 'Arequipa', price: 1100, duration: '2 d√≠as', difficulty: 'Experto', img: 'https://images.unsplash.com/photo-1522163182402-834f60b58e26', detail: 'Sube al volc√°n guardi√°n de la ciudad blanca.', whatYouDo: ['Campamento 4500m', 'Cr√°ter'], steps: [{ n: 'G', t: 'Arequipa', d: 'Salida' }, { n: 'dot', t: 'Cumbre', d: 'Cumbre' }], inc: ['Gu√≠a AGMP'] },
            { id: 33, title: 'Rafting R√≠o Chili', dept: 'Arequipa', price: 150, duration: '1 d√≠a', difficulty: 'Media', img: 'https://images.unsplash.com/photo-1534067783941-51c9c23ecefd', detail: 'R√°pidos clase III a clase IV.', whatYouDo: ['Acci√≥n R√≠o', 'Equipos Seguridad'], steps: [{ n: 'G', t: 'Charcani', d: 'Brief' }, { n: 'dot', t: 'Puente', d: 'Final' }], inc: ['Bote'] },
            { id: 34, title: 'Canteras del Sillar', dept: 'Arequipa', price: 60, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1587547131116-a0655a526190', detail: 'La historia de la piedra volc√°nica.', whatYouDo: ['Tallados', 'Quebrada Culebrillas'], steps: [{ n: 'G', t: 'Centro', d: 'Tour' }, { n: 'dot', t: 'Sillar', d: 'Fin' }], inc: ['Pickup'] },
            { id: 35, title: 'Ascenso Chachani', dept: 'Arequipa', price: 950, duration: '2 d√≠as', difficulty: 'Experto', img: 'https://images.unsplash.com/photo-1544198365-f5d60b6d8190', detail: 'Sencillo paso por los 6,000m.', whatYouDo: ['Puna', 'Viento Piel'], steps: [{ n: 'G', t: 'Campo Base', d: 'Alta' }, { n: 'dot', t: '6075m', d: 'Top' }], inc: ['Ox√≠geno'] },

            // LIMA (5)
            { id: 36, title: 'Parapente Costa Verde', dept: 'Lima', price: 280, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1534447677768-be436bb09401', detail: 'Vuelo sobre los acantilados de Lima.', whatYouDo: ['T√°ndem Miraflores', 'Vistas Mar'], steps: [{ n: 'G', t: 'Parapuerto', d: 'Briefing' }, { n: 'dot', t: 'Cielo', d: 'Landing' }], inc: ['HD Video'] },
            { id: 37, title: 'Islas Palomino Swim', dept: 'Lima', price: 180, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1610484826917-0f101a7bf7f4', detail: 'Nada con miles de lobos marinos.', whatYouDo: ['Crucero Callao', 'Lobos Marinos'], steps: [{ n: 'G', t: 'Muelle', d: 'Check' }, { n: 'dot', t: 'Mar', d: 'Nado' }], inc: ['Traje Neopreno'] },
            { id: 38, title: 'Trekking Marcahuasi', dept: 'Lima', price: 250, duration: '2 d√≠as', difficulty: 'Media', img: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b', detail: 'El bosque de piedras m√≠stico.', whatYouDo: ['Formaciones Piedra', 'Acampar Estrellas'], steps: [{ n: 'G', t: 'Chosica', d: 'Viaje' }, { n: 'dot', t: 'Meseta', d: 'Base' }], inc: ['Carpas'] },
            { id: 39, title: 'Ciclismo Lomas de L√∫cumo', dept: 'Lima', price: 120, duration: '1 d√≠a', difficulty: 'Media', img: 'https://images.unsplash.com/photo-1534067783941-51c9c23ecefd', detail: 'Mountain bike en el desierto verde.', whatYouDo: ['Rutas MTB', 'Paisajes invernales'], steps: [{ n: 'G', t: 'Pachacamac', d: 'MTB' }, { n: 'dot', t: 'Lomas', d: 'Final' }], inc: ['MTB Bike'] },
            { id: 40, title: 'Antioqu√≠a Art Village', dept: 'Lima', price: 150, duration: '1 d√≠a', difficulty: 'Baja', img: 'https://images.unsplash.com/photo-1440342359743-84fcb8c21f21', detail: 'El pueblo pintado de colores.', whatYouDo: ['Arte Calles', 'Culinaria Sierra'], steps: [{ n: 'G', t: 'Lima', d: 'Pickup' }, { n: 'dot', t: 'Antioqu√≠a', d: 'Retorno' }], inc: ['Cena Local'] }
        ];

        const events = [
            { id: 1, title: 'Ultra Trail Cordillera Blanca', cat: 'Competencia', date: '15', month: 'MAY', img: 'https://images.unsplash.com/photo-1544198365-f5d60b6d8190', price: 450, detail: 'La carrera de trail running m√°s exigente del Callej√≥n de Huaylas.', whatYouDo: ['Running 42k', 'Pasos de altura', 'Vistas glaciares'], steps: [{ n: 'G', t: 'Huaraz', d: '05:00 AM' }, { n: 'ri-map-pin-2-fill', t: 'Punta Uni√≥n', d: 'Checkpoint' }, { n: 'dot', t: 'Meta', d: 'Final' }], inc: ['Kit Competidor', 'Seguro', 'Medalla'] },
            { id: 2, title: 'Andean Adventure Film Fest', cat: 'Festival', date: '22', month: 'JUN', img: 'https://images.unsplash.com/photo-1478720568477-152d9b164e26', price: 80, detail: 'El mejor cine de aventura del mundo en pantalla gigante.', whatYouDo: ['Documentales', 'Charlas Pro', 'Networking'], steps: [{ n: 'G', t: 'Teatro', d: 'Opening' }, { n: 'dot', t: 'Cierre', d: 'Premiaci√≥n' }], inc: ['Entrada VIP', 'Bebida'] },
            { id: 3, title: 'Taller de Autorrescate VIP', cat: 'Taller', date: '05', month: 'JUL', img: 'https://images.unsplash.com/photo-1522163182402-834f60b58e26', price: 950, detail: 'Capacitaci√≥n t√©cnica avanzada para monta√±istas.', whatYouDo: ['Sistemas poleas', 'Maniobras pared', 'Primeros auxilios'], steps: [{ n: 'G', t: 'Base', d: 'Teor√≠a' }, { n: 'dot', t: 'Pared', d: 'Pr√°ctica' }], inc: ['Certificaci√≥n', 'Equipo'] },
            { id: 4, title: 'Inca Challenge MTB 100K', cat: 'Competencia', date: '18', month: 'AGO', img: 'https://images.unsplash.com/photo-1534067783941-51c9c23ecefd', price: 320, detail: 'Marat√≥n de MTB por senderos incas originales.', whatYouDo: ['Descensos t√©cnicos', 'Cruces de r√≠os'], steps: [{ n: 'G', t: 'Plaza', d: 'Partida' }, { n: 'dot', t: 'Valle', d: 'Meta' }], inc: ['Jersey', 'Hidrataci√≥n'] },
            { id: 5, title: 'Summit Photography Workshop', cat: 'Taller', date: '12', month: 'SEP', img: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b', price: 1200, detail: 'Inmortaliza la monta√±a con gu√≠as pro y fot√≥grafos.', whatYouDo: ['Astrofotograf√≠a', 'Landscape Pro'], steps: [{ n: 'G', t: 'Lodge', d: 'Setup' }, { n: 'dot', t: 'Cumbre', d: 'Captura' }], inc: ['Transporte', 'Edici√≥n'] },
            { id: 6, title: 'Paracas Sand Festival', cat: 'Festival', date: '30', month: 'OCT', img: 'https://images.unsplash.com/photo-1506461883276-594a12b11cf3', price: 150, detail: 'M√∫sica, deporte y arte en las dunas de Paracas.', whatYouDo: ['DJs en vivo', 'Sandboard Jam'], steps: [{ n: 'G', t: 'Camp', d: 'Inicio' }, { n: 'dot', t: 'Dunas', d: 'Party' }], inc: ['Acceso Free'] },
            { id: 7, title: 'Amazonas Kayak Marathon', cat: 'Competencia', date: '10', month: 'NOV', img: 'https://images.unsplash.com/photo-1516306580123-e6e52b1b7b5f', price: 550, detail: 'Rema contra la corriente en el r√≠o m√°s largo.', whatYouDo: ['Resistencia r√≠o', 'Navegaci√≥n'], steps: [{ n: 'G', t: 'Iquitos', d: 'Salida' }, { n: 'dot', t: 'Lodge', d: 'Final' }], inc: ['Kayak Pro', 'Chef'] },
            { id: 8, title: 'Clinica de Escalada en Hielo', cat: 'Taller', date: '15', month: 'DIC', img: 'https://images.unsplash.com/photo-1527004013197-29007328905b', price: 1800, detail: 'Domina los glaciares con herramientas t√©cnicas.', whatYouDo: ['Uso crampones', 'Tornillos hielo'], steps: [{ n: 'G', t: 'Morrena', d: 'Ascenso' }, { n: 'dot', t: 'Muro', d: 'Escalada' }], inc: ['Botas', 'Piolets'] },
            { id: 9, title: 'Lifextreme Elite Gala 2026', cat: 'Evento Social', date: '28', month: 'ENE', img: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e', price: 450, detail: 'La noche de gala para los socios m√°s activos.', whatYouDo: ['Cena Michelin', 'Premiaci√≥n'], steps: [{ n: 'G', t: 'Hotel', d: 'Red Carpet' }, { n: 'dot', t: 'Gala', d: 'Party' }], inc: ['Catering', 'Open Bar'] },
            { id: 10, title: 'Navidad en el Ausangate', cat: 'Expedici√≥n', date: '24', month: 'DIC', img: 'https://images.unsplash.com/photo-1440342359743-84fcb8c21f21', price: 2500, detail: 'Una navidad m√≠stica alrededor del Apu sagrado.', whatYouDo: ['Fogatas', 'Ceremonia nieve'], steps: [{ n: 'G', t: 'Cusco', d: 'Salida' }, { n: 'dot', t: 'Campo', d: 'Noche' }], inc: ['Mulas', 'Tents VIP'] }
        ];

        const equips = [
            // MOCHILAS (5)
            { name: 'Osprey Aether 65 Elite', cat: 'Mochilas', price: 1250, img: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62' },
            { name: 'Mammal Pro 45L Tactical', cat: 'Mochilas', price: 850, img: 'https://images.unsplash.com/photo-1622260614153-03223fb72052' },
            { name: 'Arc teryx Bora 75', cat: 'Mochilas', price: 1800, img: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62' },
            { name: 'Gregory Baltoro 85 Pro', cat: 'Mochilas', price: 1100, img: 'https://images.unsplash.com/photo-1622260614153-03223fb72052' },
            { name: 'Black Diamond Speed 30', cat: 'Mochilas', price: 650, img: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62' },

            // CALZADO (5)
            { name: 'La Sportiva Nepal Cube', cat: 'Calzado', price: 2150, img: 'https://images.unsplash.com/photo-1605235186531-bbd45dc11204' },
            { name: 'Scarpa Phantom 6000', cat: 'Calzado', price: 3200, img: 'https://images.unsplash.com/photo-1604176354204-926873ff3da9' },
            { name: 'Salomon Quest 4 GTX', cat: 'Calzado', price: 950, img: 'https://images.unsplash.com/photo-1605235186531-bbd45dc11204' },
            { name: 'Zamberlan Vioz Lux', cat: 'Calzado', price: 1300, img: 'https://images.unsplash.com/photo-1604176354204-926873ff3da9' },
            { name: 'Merrell Moab 3 Tactical', cat: 'Calzado', price: 750, img: 'https://images.unsplash.com/photo-1605235186531-bbd45dc11204' },

            // ACCESORIOS (5)
            { name: 'Black Diamond Spot 400', cat: 'Accesorios', price: 220, img: 'https://images.unsplash.com/photo-1506461883276-594a12b11cf3' },
            { name: 'Garmin InReach Mini 2', cat: 'Accesorios', price: 1650, img: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30' },
            { name: 'Petzl Summit Evo Axe', cat: 'Accesorios', price: 780, img: 'https://images.unsplash.com/photo-1506377247377-2a5b3b0ca3ef' },
            { name: 'BioLite SolarPanel 5+', cat: 'Accesorios', price: 420, img: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30' },
            { name: 'Therma-Rest NeoAir XTherm', cat: 'Accesorios', price: 950, img: 'https://images.unsplash.com/photo-1506377247377-2a5b3b0ca3ef' }
        ];

        let cart = [];
        let activeTour = null;
        let selectedDay = null;
        let selectedAddons = [];
        let wishlist = [];
        let completedTours = [
            { id: 1, title: 'Inca Trail 4D', ratings: { guide: 5, equipment: 4, difficulty: 5 } },
            { id: 6, title: 'Santa Cruz Trek 4D', ratings: { guide: 5, equipment: 5, difficulty: 4 } },
            { id: 21, title: 'Sandboarding Huacachina', ratings: null }
        ];
        let activeFeedbackTour = null;
        let currentRatings = { guide: 0, equipment: 0, difficulty: 0 };
        let equipmentRecommendations = []; // Track recommendations for Open Evolve

        // Equipment recommendation mapping by tour type
        const tourEquipmentMap = {
            'Cusco': ['Osprey Aether 65 Elite', 'La Sportiva Nepal Cube', 'Black Diamond Spot 400'],
            'Huaraz': ['Arc teryx Bora 75', 'Scarpa Phantom 6000', 'Petzl Summit Evo Axe', 'Therma-Rest NeoAir XTherm'],
            'Iquitos': ['Mammal Pro 45L Tactical', 'Merrell Moab 3 Tactical', 'Garmin InReach Mini 2'],
            'Piura': ['Black Diamond Speed 30', 'Salomon Quest 4 GTX', 'BioLite SolarPanel 5+'],
            'ICA': ['Gregory Baltoro 85 Pro', 'Zamberlan Vioz Lux', 'Black Diamond Spot 400'],
            'Puno': ['Osprey Aether 65 Elite', 'Salomon Quest 4 GTX', 'Therma-Rest NeoAir XTherm'],
            'Arequipa': ['Arc teryx Bora 75', 'La Sportiva Nepal Cube', 'Petzl Summit Evo Axe'],
            'Lima': ['Black Diamond Speed 30', 'Merrell Moab 3 Tactical', 'Garmin InReach Mini 2']
        };

        // Kit templates for complete packages
        const kitTemplates = {
            'Alta Monta√±a': {
                name: 'Kit Monta√±a Elite',
                items: ['Arc teryx Bora 75', 'Scarpa Phantom 6000', 'Petzl Summit Evo Axe', 'Therma-Rest NeoAir XTherm'],
                icon: 'ri-landscape-line',
                description: 'Todo lo que necesitas para conquistar los picos m√°s altos'
            },
            'Selva': {
                name: 'Kit Jungle Pro',
                items: ['Mammal Pro 45L Tactical', 'Merrell Moab 3 Tactical', 'Garmin InReach Mini 2', 'BioLite SolarPanel 5+'],
                icon: 'ri-cactus-line',
                description: 'Equipo especializado para expediciones en la Amazon√≠a'
            },
            'Costa & Desierto': {
                name: 'Kit Coastal Adventure',
                items: ['Black Diamond Speed 30', 'Salomon Quest 4 GTX', 'BioLite SolarPanel 5+', 'Black Diamond Spot 400'],
                icon: 'ri-temp-hot-line',
                description: 'Perfecto para dunas, playas y aventuras costeras'
            },
            'Trekking General': {
                name: 'Kit Explorer',
                items: ['Osprey Aether 65 Elite', 'La Sportiva Nepal Cube', 'Black Diamond Spot 400', 'Garmin InReach Mini 2'],
                icon: 'ri-footprint-line',
                description: 'El kit vers√°til para cualquier tipo de trekking'
            }
        };

        let kitPurchases = []; // Track kit analytics
        let currentKit = null;

        // --- SPA ---
        function navigateTo(id) {
            document.querySelectorAll('.section-view').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById('section-' + id).classList.add('active');
            document.getElementById('nav-' + id)?.classList.add('active');
            if (id === 'socio') {
                updateWishlistDashboard();
                updateCompletedToursDashboard();
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- RENDERERS ---
        function renderAll(region = 'Todos', eqCat = 'Todos') {
            const grid = document.getElementById('destinos-grid');
            const filteredTours = region === 'Todos' ? tours : tours.filter(t => t.dept.toLowerCase() === region.toLowerCase());
            grid.innerHTML = filteredTours.map(t => {
                const scarcity = Math.floor(Math.random() * 5) + 2; // Random 2-6 slots
                const isUrgent = scarcity < 4;
                const isSalkantay = t.id === 2;
                return `
                <div class="bg-white rounded-[40px] overflow-hidden border border-slate-50 shadow-sm hover:shadow-2xl transition-all cursor-pointer group relative" onclick="openBooking(${t.id})">
                    ${isUrgent ? `
                        <div class="absolute top-4 left-4 z-10 bg-red-500 text-white text-[8px] font-black px-3 py-1.5 rounded-full flex items-center gap-1.5 shadow-lg pulse-red">
                            <i class="ri-fire-fill"></i> ¬°SOLO ${scarcity} CUPOS!
                        </div>
                    ` : `
                        <div class="absolute top-4 left-4 z-10 bg-white/90 backdrop-blur-md text-slate-800 text-[8px] font-black px-3 py-1.5 rounded-full flex items-center gap-1.5 shadow-sm">
                            <i class="ri-eye-line text-primary"></i> ${Math.floor(Math.random() * 20) + 10} personas viendo esto
                        </div>
                    `}
                    ${isSalkantay ? `
                        <button onclick="event.stopPropagation(); challengeFriend(${t.id})" class="absolute top-4 right-4 z-10 bg-[#25D366] text-white text-[10px] font-black px-4 py-2 rounded-full flex items-center gap-2 shadow-lg hover:scale-105 transition-all">
                            <i class="ri-whatsapp-line text-lg"></i> RETAR AMIGO
                        </button>
                    ` : ''}
                    <div class="h-64 overflow-hidden relative"><img src="${t.img}?w=500" class="w-full h-full object-cover group-hover:scale-110 transition-all duration-700"></div>
                    <div class="p-8">
                        <div class="flex justify-between items-start mb-2">
                            <p class="text-[9px] font-black text-primary uppercase tracking-widest">${t.dept}</p>
                            <button onclick="toggleWishlist(${t.id})" class="text-xl ${wishlist.includes(t.id) ? 'text-secondary' : 'text-slate-300'} hover:scale-125 transition-all">
                                <i class="${wishlist.includes(t.id) ? 'ri-heart-pulse-fill' : 'ri-heart-pulse-line'}"></i>
                            </button>
                        </div>
                        <h3 class="text-xl font-black italic mb-6 leading-tight">${t.title}</h3>
                        <div class="flex items-center justify-between border-t border-slate-50 pt-6">
                            <span class="text-2xl font-black italic">S/ ${t.price}</span>
                            <div class="w-10 h-10 bg-indigo-50 text-primary rounded-xl flex items-center justify-center group-hover:bg-primary group-hover:text-white transition-all"><i class="ri-arrow-right-line"></i></div>
                        </div>
                    </div>
                </div>
                `;
            }).join('') || '<p class="col-span-full text-center py-10 font-bold text-slate-300 italic">No hay expediciones en esta zona a√∫n.</p>';

            document.getElementById('events-grid').innerHTML = events.map(e => `
                <div class="bg-white rounded-[40px] overflow-hidden relative group cursor-pointer" onclick="openBooking(${e.id}, true)">
                    <img src="${e.img}?w=600" class="h-64 w-full object-cover opacity-90 group-hover:opacity-100 transition-all">
                    <div class="absolute top-6 right-6 bg-white w-14 h-16 rounded-2xl flex flex-col items-center justify-center shadow-xl">
                        <span class="text-xl font-black">${e.date}</span><span class="text-[9px] font-bold text-primary">${e.month}</span>
                    </div>
                    <div class="p-8">
                        <span class="px-3 py-1 bg-indigo-50 text-primary rounded-lg text-[8px] font-black uppercase mb-4 inline-block">${e.cat}</span>
                        <h4 class="font-black text-lg italic text-slate-900 mb-4">${e.title}</h4>
                        <div class="flex justify-between items-center border-t border-slate-50 pt-4">
                            <span class="font-black italic">S/ ${e.price}</span>
                            <span class="text-[9px] font-black uppercase text-accent tracking-widest">Inscribirme</span>
                        </div>
                    </div>
                </div>
            `).join('');

            const filteredEquips = eqCat === 'Todos' ? equips : equips.filter(e => e.cat === eqCat);
            document.getElementById('equip-grid').innerHTML = filteredEquips.map(e => `
                <div class="bg-white p-8 rounded-[40px] border border-slate-50 flex items-center gap-8 shadow-sm hover:shadow-xl transition-all">
                    <img src="${e.img}?w=200" class="w-24 h-24 rounded-2xl object-cover bg-slate-50">
                    <div class="flex-1">
                        <p class="text-[8px] font-black text-slate-400 uppercase tracking-widest mb-1">${e.cat}</p>
                        <h4 class="font-black italic text-md mb-2 leading-tight">${e.name}</h4>
                        <p class="text-xl font-black text-primary italic">S/ ${e.price}</p>
                    </div>
                    <button onclick="addToCartShort('${e.name}', ${e.price}, '${e.img}')" class="bg-slate-9100 text-white w-12 h-12 rounded-xl flex items-center justify-center hover:bg-primary transition-all shadow-lg"><i class="ri-add-line text-xl"></i></button>
                </div>
            `).join('');

            document.getElementById('guides-grid').innerHTML = ['Mendoza', 'S√°nchez', 'Palacios', 'Flores', 'Vargas', 'Ramos', 'Torres', 'Castro'].map(n => `
                <div class="bg-white rounded-[32px] overflow-hidden border border-slate-50 text-center pb-8 hover:shadow-xl transition-all">
                    <img src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=500" class="h-48 w-full object-cover mb-4 grayscale hover:grayscale-0 transition-all duration-500">
                    <h4 class="font-black italic text-lg">${n}</h4>
                    <p class="text-[9px] font-black text-primary uppercase mb-6">Staff Certified UIAGM</p>
                    <button class="px-6 py-2 border border-indigo-50 rounded-xl text-[10px] font-black uppercase text-slate-400 hover:border-primary hover:text-primary transition-all">Perfil Pro</button>
                </div>
            `).join('');
        }

        function selRegion(r) {
            document.querySelectorAll('.region-chip').forEach(c => {
                c.classList.remove('active');
                if (c.innerText === r) c.classList.add('active');
            });
            renderAll(r);
        }

        // --- BOOKING ---
        let participants = 1;

        function openBooking(id, isEvent = false) {
            activeTour = isEvent ? events.find(e => e.id === id) : tours.find(t => t.id === id);
            if (!activeTour) return;
            selectedDay = isEvent ? activeTour.date : null;
            participants = 1;
            selectedAddons = [];
            document.querySelectorAll('.addon-check').forEach(c => c.checked = false);

            document.getElementById('b-title').innerText = activeTour.title;
            document.getElementById('b-dept').innerText = isEvent ? activeTour.cat.toUpperCase() : activeTour.dept + ", PER√ö";
            updateBookingPrice();
            document.getElementById('availability-status').innerHTML = isEvent ? `
                <div class="flex items-center gap-2 text-secondary">
                    <i class="ri-checkbox-circle-fill"></i>
                    <span class="text-[10px] font-black uppercase tracking-widest">Inscripciones Abiertas - ${activeTour.date} ${activeTour.month}</span>
                </div>
            ` : '';
            document.getElementById('pax-count').innerText = participants.toString().padStart(2, '0');

            // Render High-Fidelity Content (V29)
            document.getElementById('b-cancel-policy').innerText = activeTour.genInfo?.cancelPolicy || 'Pol√≠tica est√°ndar';
            document.getElementById('b-duration').innerText = activeTour.genInfo?.duration || 'Variable';
            document.getElementById('b-availability').innerText = activeTour.genInfo?.availability || 'Consultar disponibilidad';
            document.getElementById('b-guide-lang').innerText = activeTour.genInfo?.guide || 'Espa√±ol / Ingl√©s';
            document.getElementById('b-group-size').innerText = activeTour.genInfo?.groupSize || 'Grupo est√°ndar';

            // What you do
            document.getElementById('itinerary-what-you-do').innerHTML = (activeTour.whatYouDo || []).map(item => `
                <li class="flex items-start gap-3">
                    <div class="w-1.5 h-1.5 bg-primary rounded-full mt-1.5 shrink-0"></div>
                    <span>${item}</span>
                </li>
            `).join('');

            // Detailed Days (In Detail)
            if (activeTour.fullItinerary) {
                document.getElementById('itinerary-detailed-days').innerHTML = activeTour.fullItinerary.map(day => `
                    <div class="space-y-4">
                        <div class="flex items-center gap-3">
                            <span class="px-3 py-1 bg-primary/10 text-primary text-[10px] font-black uppercase rounded-lg italic">D√≠a ${day.day}</span>
                        </div>
                        <p class="text-[11px] font-bold text-slate-500 leading-relaxed">${day.desc}</p>
                    </div>
                `).join('');
            } else {
                document.getElementById('itinerary-detailed-days').innerHTML = `<p class="text-[11px] font-bold text-slate-500">${activeTour.detail}</p>`;
            }

            // Inclusions
            document.getElementById('itinerary-inclusions').innerHTML = (activeTour.inc || []).map(i => `
                <li class="flex items-center gap-3"><i class="ri-checkbox-circle-fill text-secondary text-lg"></i> <span class="font-bold">${i}</span></li>
            `).join('');

            // Restrictions
            document.getElementById('itinerary-restrictions').innerHTML = (activeTour.notSuitable || ['Personas con movilidad reducida']).map(r => `
                <li class="flex items-center gap-3"><i class="ri-close-circle-fill text-red-400 text-lg"></i> <span>${r}</span></li>
            `).join('');

            // Meeting Point
            document.getElementById('b-meeting-point').innerText = activeTour.meetingPoint || 'Plaza de Armas de Cusco (Centro)';

            // Important Info
            document.getElementById('b-important-info').innerText = activeTour.importantInfo || 'Llevar ropa c√≥moda y protector solar.';

            // Legacy Itinerary Flow (Keep for visual consistency)
            document.getElementById('itinerary-flow').innerHTML = '<div class="timeline-line"></div>' + (activeTour.steps || []).map(s => `
                <div class="step">
                    <div class="step-node ${s.n === 'dot' ? 'bg-accent border-accent !w-3 !h-3 !ml-[4px] !mt-[6px]' : ''}">
                        ${s.n === 'G' ? 'G' : (s.n === 'dot' ? '' : `<i class="${s.n}"></i>`)}
                    </div>
                    <div>
                        <p class="font-black text-[12px] text-slate-800">${s.t}</p>
                        <p class="text-[10px] font-bold text-slate-500 italic">${s.d}</p>
                    </div>
                </div>
            `).join('');

            // Calendar logic
            if (isEvent) {
                document.getElementById('calendar-grid').innerHTML = '<p class="col-span-full text-center py-4 text-[10px] font-black text-primary uppercase bg-indigo-50 rounded-2xl">Fecha √önica del Evento</p>';
                document.getElementById('add-btn').disabled = false;
                document.getElementById('add-btn').classList.remove('opacity-30', 'cursor-not-allowed');
            } else {
                let days = '';
                for (let i = 1; i <= 28; i++) {
                    days += `<div class="day-box ${selectedDay === i ? 'selected' : ''}" onclick="selDay(${i})">${i}</div>`;
                }
                document.getElementById('calendar-grid').innerHTML = days;
                document.getElementById('add-btn').disabled = true;
                document.getElementById('add-btn').classList.add('opacity-30', 'cursor-not-allowed');
            }

            // Render Recommended Equipment
            if (!isEvent) {
                const recommendedEquip = getRecommendedEquipment(activeTour.dept);
                const equipNames = recommendedEquip.map(e => e.name);
                trackRecommendationView(activeTour.id, equipNames);

                document.getElementById('recommended-equipment-list').innerHTML = recommendedEquip.slice(0, 3).map(e => `
                    <div class="flex items-center justify-between bg-white p-4 rounded-2xl border border-slate-100 hover:border-primary transition-all group">
                        <div class="flex items-center gap-4 flex-1">
                            <img src="${e.img}?w=80" class="w-12 h-12 rounded-xl object-cover bg-slate-50">
                            <div class="flex-1">
                                <p class="text-[9px] font-black text-slate-400 uppercase">${e.cat}</p>
                                <p class="text-[11px] font-black italic text-slate-800 leading-tight">${e.name}</p>
                                <p class="text-sm font-black text-primary italic mt-1">S/ ${e.price}</p>
                            </div>
                        </div>
                        <button onclick="addRecommendedToCart('${e.name}', ${e.price}, '${e.img}', ${activeTour.id})" class="bg-slate-900 text-white px-4 py-2 rounded-xl text-[9px] font-black uppercase tracking-widest hover:bg-primary transition-all">
                            <i class="ri-add-line"></i> Agregar
                        </button>
                    </div>
                `).join('');
            }

            // Challenge Button for Salkantay (V30)
            if (activeTour.id === 2) {
                const challengeBtnHtml = `
                    <div class="mt-8 p-6 bg-gradient-to-br from-indigo-900 to-slate-900 rounded-[32px] border border-white/10 shadow-2xl relative overflow-hidden group">
                        <div class="absolute -right-10 -top-10 w-40 h-40 bg-primary/20 rounded-full blur-3xl group-hover:bg-primary/40 transition-all"></div>
                        <div class="relative z-10 flex flex-col md:flex-row items-center gap-6">
                            <div class="w-16 h-16 bg-white/10 backdrop-blur-md rounded-2xl flex items-center justify-center text-3xl">‚öîÔ∏è</div>
                            <div class="flex-1 text-center md:text-left">
                                <h4 class="text-white font-black italic text-lg mb-1 uppercase tracking-tighter">¬øAceptas el Reto Salkantay?</h4>
                                <p class="text-white/60 text-[10px] font-bold">Reta a un amigo a conquistar los Andes contigo via WhatsApp.</p>
                            </div>
                            <button onclick="challengeFriend(2)" class="w-full md:w-auto bg-[#25D366] hover:bg-[#128C7E] text-white px-8 py-4 rounded-2xl font-black italic text-[12px] flex items-center justify-center gap-3 transition-all shadow-xl hover:scale-105 active:scale-95">
                                <i class="ri-whatsapp-line text-xl"></i> ENVIAR RETO
                            </button>
                        </div>
                    </div>
                `;
                document.getElementById('recommended-equipment-list').insertAdjacentHTML('afterend', challengeBtnHtml);
            }

            document.getElementById('booking-modal').classList.remove('hidden');
        }

        function updateBookingPrice() {
            let baseTotal = activeTour.price * participants;
            let addonsTotal = selectedAddons.reduce((acc, a) => acc + a.price, 0);

            // Apply 15% discount on addons if 2 or more are selected (Bundle Effect)
            if (selectedAddons.length >= 2) {
                addonsTotal = addonsTotal * 0.85;
            }

            const total = baseTotal + addonsTotal;
            document.getElementById('b-total-price').innerText = "S/ " + Math.round(total);
        }

        function toggleAddon(id, price, name) {
            const index = selectedAddons.findIndex(a => a.id === id);
            if (index > -1) {
                selectedAddons.splice(index, 1);
            } else {
                selectedAddons.push({ id, price, name });
            }
            updateBookingPrice();
        }

        function changePax(delta) {
            participants = Math.max(1, Math.min(10, participants + delta));
            document.getElementById('pax-count').innerText = participants.toString().padStart(2, '0');
            updateBookingPrice();
        }

        function selDay(d) {
            selectedDay = d;

            // Update UI state
            document.querySelectorAll('.day-box').forEach(b => b.classList.remove('selected'));
            event.target.classList.add('selected');

            const status = document.getElementById('availability-status');
            const btn = document.getElementById('add-btn');

            btn.disabled = true;
            btn.classList.add('opacity-30', 'cursor-not-allowed');

            status.innerHTML = `
                <div class="flex items-center gap-2 text-primary">
                    <i class="ri-loader-4-line animate-spin"></i>
                    <span class="text-[10px] font-black uppercase tracking-widest">Validando Disponibilidad T√°ctica...</span>
                </div>
            `;

            setTimeout(() => {
                status.innerHTML = `
                    <div class="flex items-center gap-2 text-secondary animate-fadeIn">
                        <i class="ri-checkbox-circle-fill"></i>
                        <span class="text-[10px] font-black uppercase tracking-widest">Cupos Confirmados para el ${d} de Marzo</span>
                    </div>
                `;
                btn.disabled = false;
                btn.classList.remove('opacity-30', 'cursor-not-allowed');
            }, 1200);
        }

        function closeModal() { document.getElementById('booking-modal').classList.add('hidden'); }

        // --- CART ---
        function toggleCart() { document.getElementById('cart-drawer').classList.toggle('translate-x-full'); }
        function addToCartFinal() {
            let baseTotal = activeTour.price * participants;
            let addonsTotal = selectedAddons.reduce((acc, a) => acc + a.price, 0);
            if (selectedAddons.length >= 2) addonsTotal = addonsTotal * 0.85;

            const totalPrice = baseTotal + addonsTotal;
            const addonNames = selectedAddons.map(a => a.name).join(', ');

            cart.push({
                name: activeTour.title,
                price: Math.round(totalPrice),
                img: activeTour.img,
                detail: `${selectedDay} Marzo - ${participants} Pax ${selectedAddons.length > 0 ? '+ Pack: ' + addonNames : ''}`
            });
            updateCart(); closeModal(); toggleCart();
        }
        function addToCartShort(name, price, img) {
            cart.push({ name, price, img, detail: 'Venta T√©cnica' });
            updateCart(); toggleCart();
        }
        function updateCart() {
            const list = document.getElementById('cart-list');
            document.getElementById('cart-count').innerText = cart.length;
            if (cart.length === 0) { list.innerHTML = '<p class="text-center py-20 text-slate-300 font-black italic">Mochila vac√≠a</p>'; updatePrices(0); return; }

            list.innerHTML = cart.map((item, idx) => `
                <div class="flex items-center gap-6 bg-slate-50 p-6 rounded-3xl">
                    <img src="${item.img}?w=100" class="w-16 h-16 rounded-2xl object-cover">
                    <div class="flex-1"><h4 class="font-black italic text-[11px] mb-1">${item.name}</h4><p class="text-[9px] font-bold text-slate-400 italic">${item.detail}</p></div>
                    <div class="text-right"><p class="font-black text-sm italic">S/ ${item.price}</p><button onclick="remItem(${idx})" class="text-slate-300 hover:text-red-500 transition-all"><i class="ri-delete-bin-line"></i></button></div>
                </div>
            `).join('');

            // Up-selling Logic
            const upsellContainer = document.getElementById('upsell-container');
            const upsellList = document.getElementById('upsell-list');

            if (cart.length > 0) {
                upsellContainer.classList.remove('hidden');
                // Suggest 2 random items from equips that are NOT already in cart
                const suggestions = equips
                    .filter(e => !cart.some(c => c.name === e.name))
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 2);

                upsellList.innerHTML = suggestions.map(e => `
                    <div class="flex items-center gap-4 bg-white border border-slate-100 p-4 rounded-2xl shadow-sm">
                        <img src="${e.img}?w=80" class="w-12 h-12 rounded-xl object-cover grayscale">
                        <div class="flex-1">
                            <h5 class="font-black text-[9px] uppercase leading-tight">${e.name}</h5>
                            <p class="text-[10px] font-black text-primary italic">S/ ${e.price}</p>
                        </div>
                        <button onclick="addToCartShort('${e.name}', ${e.price}, '${e.img}')" class="w-8 h-8 bg-indigo-50 text-primary rounded-lg flex items-center justify-center hover:bg-primary hover:text-white transition-all">
                            <i class="ri-add-line"></i>
                        </button>
                    </div>
                `).join('');
            } else {
                upsellContainer.classList.add('hidden');
            }

            let total = cart.reduce((acc, obj) => acc + obj.price, 0);
            updatePrices(total);
        }
        function remItem(i) { cart.splice(i, 1); updateCart(); }
        function updatePrices(sub) {
            let total = sub * 0.85; // Fixed Elite Discount for Alex
            document.getElementById('cart-total').innerText = "S/ " + (sub === 0 ? 0 : total).toLocaleString();
        }
        function processPay() {
            if (confirm("Confirmar pago de S/ " + document.getElementById('cart-total').innerText + " v√≠a BITCOIN?")) {
                alert("¬°Felicidades Alex! Reserva t√©cnica confirmada: LIFE-ULT-26.");
                cart = []; updateCart(); toggleCart();
            }
        }

        // --- CHATBOT (V27) ---
        function toggleAIDrawer() { document.getElementById('ai-drawer').classList.toggle('hidden'); }
        function sendAIMessage() {
            const input = document.getElementById('ai-input');
            const msg = input.value.trim();
            if (!msg) return;

            const box = document.getElementById('ai-messages');
            box.innerHTML += `
                <div class="flex justify-end gap-3">
                    <div class="bg-primary text-white p-4 rounded-2xl rounded-tr-none shadow-sm">
                        <p class="text-[11px] font-bold">${msg}</p>
                    </div>
                </div>
            `;
            input.value = '';
            box.scrollTo(0, box.scrollHeight);

            setTimeout(() => {
                box.innerHTML += `
                    <div class="flex gap-3">
                        <div class="w-8 h-8 bg-indigo-50 rounded-lg flex items-center justify-center text-primary shrink-0"><i class="ri-sparkling-fill"></i></div>
                        <div class="bg-white p-4 rounded-2xl rounded-tl-none border border-slate-100 shadow-sm animate-fadeIn">
                            <p class="text-[11px] font-bold text-slate-600 leading-relaxed italic">Comprendido, Alex. Analizando disponibilidad t√°ctica para tu consulta. Te recomiendo revisar el evento de Trail Running en Vinicunca, ¬°ser√° √©pico!</p>
                        </div>
                    </div>
                `;
                box.scrollTo(0, box.scrollHeight);
            }, 1000);
        }

        // --- FOMO ENGINE ---
        const fomoNames = ['Gaby', 'Lucho', 'Carlos', 'Sof√≠a', 'Marco', 'Andrea', 'Joaqu√≠n', 'Luc√≠a'];
        const fomoCities = ['Lima', 'Cusco', 'Arequipa', 'Trujillo', 'Santiago', 'Quito'];

        function showFomoPopup() {
            const container = document.getElementById('fomo-container');
            const name = fomoNames[Math.floor(Math.random() * fomoNames.length)];
            const city = fomoCities[Math.floor(Math.random() * fomoCities.length)];
            const tour = tours[Math.floor(Math.random() * tours.length)].title;

            const popup = document.createElement('div');
            popup.className = 'fomo-popup bg-white/95 backdrop-blur-md p-4 rounded-2xl shadow-2xl border border-indigo-50 flex items-center gap-4 max-w-xs pointer-events-auto';
            popup.innerHTML = `
                <div class="w-10 h-10 bg-indigo-50 rounded-xl flex items-center justify-center text-primary shrink-0">
                    <i class="ri-shopping-cart-2-fill text-xl"></i>
                </div>
                <div>
                    <p class="text-[10px] font-black text-slate-800 leading-tight">${name} de ${city}</p>
                    <p class="text-[9px] font-bold text-slate-500 italic">Reserv√≥ ${tour}</p>
                    <p class="text-[8px] font-black text-secondary uppercase mt-1">¬°Hace 2 minutos!</p>
                </div>
            `;

            container.appendChild(popup);
            setTimeout(() => {
                popup.style.opacity = '0';
                popup.style.transform = 'translateX(-20px)';
                popup.style.transition = 'all 0.5s';
                setTimeout(() => popup.remove(), 500);
            }, 5000);

            // Schedule next popup (random between 8 and 20 seconds)
            setTimeout(showFomoPopup, Math.random() * 12000 + 8000);
        }

        // --- ADVENTURE QUIZ ENGINE ---
        let quizData = { level: '', environment: '' };

        function openQuiz() {
            document.getElementById('quiz-modal').classList.remove('hidden');
            nextQuizStep(1); // Set basics
        }

        function closeQuiz() {
            document.getElementById('quiz-modal').classList.add('hidden');
            setTimeout(() => {
                document.querySelectorAll('.quiz-step').forEach(s => s.classList.add('hidden'));
                document.getElementById('quiz-step-1').classList.remove('hidden');
            }, 500);
        }

        function nextQuizStep(step, val) {
            if (val) {
                if (step === 2) quizData.level = val;
                if (step === 3) quizData.environment = val;
            }
            document.querySelectorAll('.quiz-step').forEach(s => s.classList.add('hidden'));
            document.getElementById('quiz-step-' + step).classList.remove('hidden');
        }

        function finishQuiz() {
            const email = document.getElementById('quiz-email').value;
            if (!email.includes('@')) { alert('Ingresa un email v√°lido'); return; }

            // Recommendation Logic
            let rec = 'Machu Picchu por Tren';
            if (quizData.level === 'elite' && quizData.environment === 'monta√±a') rec = 'Nevado Huascar√°n AGMP';
            if (quizData.environment === 'selva') rec = 'Pacaya Samiria Deep Safari';
            if (quizData.environment === 'costa') rec = 'Kitesurf Pro en M√°ncora';
            if (quizData.level === 'elite' && quizData.environment === 'monta√±a') rec = 'Ausangate Glaciar Challenge';

            document.getElementById('recommended-tour').innerText = rec;
            nextQuizStep('result');
        }

        // --- EQUIPMENT RECOMMENDATION ENGINE (V28) ---
        function getRecommendedEquipment(tourDept) {
            const recommendedNames = tourEquipmentMap[tourDept] || [];
            return equips.filter(e => recommendedNames.includes(e.name));
        }

        function addRecommendedToCart(equipName, price, img, tourId) {
            event.stopPropagation();
            addToCartShort(equipName, price, img);

            // Track recommendation conversion
            equipmentRecommendations.push({
                tourId: tourId,
                tourName: activeTour ? activeTour.title : 'Unknown',
                equipmentName: equipName,
                recommended: true,
                purchased: true,
                timestamp: new Date().toISOString()
            });
        }

        function trackRecommendationView(tourId, equipmentNames) {
            equipmentNames.forEach(name => {
                equipmentRecommendations.push({
                    tourId: tourId,
                    tourName: activeTour ? activeTour.title : 'Unknown',
                    equipmentName: name,
                    recommended: true,
                    purchased: false,
                    timestamp: new Date().toISOString()
                });
            });
        }

        // --- KIT BUILDER ENGINE (V28) ---
        function openKitBuilder() {
            document.getElementById('kit-builder-modal').classList.remove('hidden');
            showKitStep(1);
        }

        function closeKitBuilder() {
            document.getElementById('kit-builder-modal').classList.add('hidden');
        }

        function showKitStep(step) {
            document.querySelectorAll('.kit-step').forEach(s => s.classList.add('hidden'));
            document.getElementById('kit-step-' + step).classList.remove('hidden');
        }

        function buildKit(destination) {
            const template = kitTemplates[destination];
            if (!template) return;

            currentKit = {
                destination: destination,
                name: template.name,
                icon: template.icon,
                description: template.description,
                items: template.items.map(itemName => equips.find(e => e.name === itemName)).filter(Boolean)
            };

            // Update UI
            document.getElementById('kit-icon').className = template.icon + ' text-3xl';
            document.getElementById('kit-name').innerText = template.name;
            document.getElementById('kit-description').innerText = template.description;

            // Render items
            const totalOriginal = currentKit.items.reduce((sum, item) => sum + item.price, 0);
            const totalDiscounted = Math.round(totalOriginal * 0.8); // 20% off

            document.getElementById('kit-items-list').innerHTML = currentKit.items.map(item => `
                <div class="flex items-center gap-4 bg-white p-4 rounded-2xl border border-slate-100">
                    <img src="${item.img}?w=80" class="w-12 h-12 rounded-xl object-cover">
                    <div class="flex-1">
                        <p class="text-[9px] font-black text-slate-400 uppercase">${item.cat}</p>
                        <p class="text-[11px] font-black italic text-slate-800">${item.name}</p>
                    </div>
                    <p class="text-sm font-black text-primary">S/ ${item.price}</p>
                </div>
            `).join('');

            document.getElementById('kit-original-price').innerText = 'S/ ' + totalOriginal;
            document.getElementById('kit-final-price').innerText = 'S/ ' + totalDiscounted;

            showKitStep(2);
        }

        function addKitToCart() {
            if (!currentKit) return;

            const totalOriginal = currentKit.items.reduce((sum, item) => sum + item.price, 0);
            const totalDiscounted = Math.round(totalOriginal * 0.8);

            // Add kit as a single cart item
            cart.push({
                name: currentKit.name,
                price: totalDiscounted,
                img: currentKit.items[0].img,
                detail: `Kit completo (${currentKit.items.length} productos) - Ahorro 20%`
            });

            // Track kit purchase
            kitPurchases.push({
                destination: currentKit.destination,
                kitName: currentKit.name,
                itemCount: currentKit.items.length,
                originalPrice: totalOriginal,
                finalPrice: totalDiscounted,
                discount: totalOriginal - totalDiscounted,
                timestamp: new Date().toISOString(),
                isComplete: true
            });

            updateCart();
            closeKitBuilder();
            toggleCart();
        }

        // --- STRIPE PAYMENT INTEGRATION (V28) ---
        // Initialize Stripe (use your publishable key)
        const stripe = Stripe('pk_test_51QYourTestKeyHere'); // REPLACE WITH YOUR KEY
        let stripeElements;
        let cardElement;

        function initializeStripeElements() {
            stripeElements = stripe.elements();
            cardElement = stripeElements.create('card', {
                style: {
                    base: {
                        fontSize: '16px',
                        color: '#1e293b',
                        fontFamily: '"Montserrat", sans-serif',
                        fontWeight: '600',
                        '::placeholder': {
                            color: '#94a3b8'
                        }
                    },
                    invalid: {
                        color: '#ef4444'
                    }
                }
            });
            cardElement.mount('#card-element');

            // Handle real-time validation errors
            cardElement.on('change', function (event) {
                const displayError = document.getElementById('card-errors');
                if (event.error) {
                    displayError.textContent = event.error.message;
                } else {
                    displayError.textContent = '';
                }
            });
        }

        function openStripeCheckout() {
            if (cart.length === 0) {
                alert('Tu carrito est√° vac√≠o');
                return;
            }

            // Calculate total
            const total = cart.reduce((sum, item) => sum + item.price, 0);

            // Populate order summary
            document.getElementById('stripe-order-items').innerHTML = cart.map(item => `
                <div class="flex items-center gap-4">
                    <img src="${item.img}?w=80" class="w-16 h-16 rounded-xl object-cover">
                    <div class="flex-1">
                        <p class="text-sm font-black italic">${item.name}</p>
                        <p class="text-[9px] font-bold text-slate-500">${item.detail}</p>
                    </div>
                    <p class="text-lg font-black text-primary">S/ ${item.price}</p>
                </div>
            `).join('');

            document.getElementById('stripe-total-amount').innerText = 'S/ ' + total;
            document.getElementById('button-amount').innerText = 'S/ ' + total;

            // Show modal and initialize Stripe Elements
            document.getElementById('stripe-checkout-modal').classList.remove('hidden');

            // Initialize Stripe Elements if not already done
            if (!cardElement) {
                initializeStripeElements();
            }

            // Close cart drawer
            document.getElementById('cart-drawer').classList.add('translate-x-full');
        }

        function closeStripeCheckout() {
            document.getElementById('stripe-checkout-modal').classList.add('hidden');
        }

        // Handle form submission
        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('stripe-payment-form');
            if (form) {
                form.addEventListener('submit', async function (event) {
                    event.preventDefault();
                    await handleStripePayment();
                });
            }
        });

        async function handleStripePayment() {
            const submitButton = document.getElementById('stripe-submit-button');
            const buttonText = document.getElementById('button-text');
            const buttonSpinner = document.getElementById('button-spinner');

            // Disable button and show spinner
            submitButton.disabled = true;
            buttonText.classList.add('hidden');
            buttonSpinner.classList.remove('hidden');

            // Get customer data
            const customerName = document.getElementById('customer-name').value;
            const customerEmail = document.getElementById('customer-email').value;
            const customerPhone = document.getElementById('customer-phone').value;

            // Calculate total
            const total = cart.reduce((sum, item) => sum + item.price, 0);

            try {
                // In a real implementation, you would:
                // 1. Call your backend to create a PaymentIntent
                // 2. Get the client_secret from your backend
                // 3. Confirm the payment with Stripe

                // SIMULATED PAYMENT (since we don't have a backend)
                // In production, replace this with actual Stripe payment confirmation

                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Simulate successful payment (90% success rate)
                const isSuccess = Math.random() > 0.1;

                if (isSuccess) {
                    // Generate order number
                    const orderNumber = 'LXT-' + Date.now().toString().slice(-8);

                    // Show success modal
                    showOrderConfirmation(orderNumber, total, customerEmail);

                    // Clear cart
                    cart = [];
                    updateCart();

                    // Close checkout
                    closeStripeCheckout();
                } else {
                    throw new Error('Pago rechazado por el banco');
                }

            } catch (error) {
                // Show error
                const cardErrors = document.getElementById('card-errors');
                cardErrors.textContent = error.message || 'Ocurri√≥ un error al procesar el pago';

                // Re-enable button
                submitButton.disabled = false;
                buttonText.classList.remove('hidden');
                buttonSpinner.classList.add('hidden');
            }
        }

        function showOrderConfirmation(orderNumber, amount, email) {
            document.getElementById('order-number').innerText = orderNumber;
            document.getElementById('order-amount').innerText = 'S/ ' + amount;
            document.getElementById('order-confirmation-modal').classList.remove('hidden');

            // Simulate sending confirmation email
            console.log(`üìß Confirmation email sent to: ${email}`);
            console.log(`üì¶ Order ${orderNumber} created successfully`);
        }

        function closeOrderConfirmation() {
            document.getElementById('order-confirmation-modal').classList.add('hidden');
            navigateTo('home');
        }

        // --- CHALLENGE FRIEND FEATURE (V30) ---
        function challengeFriend(tourId) {
            const tour = tours.find(t => t.id === tourId);
            if (!tour) return;

            const currentUrl = window.location.href.split('?')[0];
            const deepLink = `${currentUrl}?tourId=${tourId}`;
            const message = `¬°Hola! Te reto a vivir la experiencia *${tour.title}* conmigo üèîÔ∏è‚öîÔ∏è. ¬øAceptas el desaf√≠o de conquistar los Andes? Mira los detalles y acepta el reto aqu√≠: ${deepLink}`;

            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        window.onload = () => {
            renderAll();
            setTimeout(showFomoPopup, 3000); // Start FOMO after 3 seconds

            // Deep Linking Check
            const urlParams = new URLSearchParams(window.location.search);
            const tourId = urlParams.get('tourId');
            if (tourId) {
                setTimeout(() => {
                    navigateTo('destinos');
                    openBooking(parseInt(tourId));
                }, 500);
            }
        };

        // --- MEMBERSHIP COUNTDOWN TIMER ---
        function startMembershipCountdown() {
            // Set deadline: 7 days from now
            const deadline = new Date();
            deadline.setDate(deadline.getDate() + 7);
            deadline.setHours(23, 59, 59, 999);

            function updateCounter() {
                const now = new Date().getTime();
                const distance = deadline - now;

                // Calculate time units
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                // Update DOM
                const daysEl = document.getElementById('days');
                const hoursEl = document.getElementById('hours');
                const minutesEl = document.getElementById('minutes');
                const secondsEl = document.getElementById('seconds');

                if (daysEl) daysEl.textContent = String(days).padStart(2, '0');
                if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
                if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
                if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');

                // If countdown finished
                if (distance < 0) {
                    clearInterval(countdownInterval);
                    if (daysEl) daysEl.textContent = '00';
                    if (hoursEl) hoursEl.textContent = '00';
                    if (minutesEl) minutesEl.textContent = '00';
                    if (secondsEl) secondsEl.textContent = '00';
                }
            }

            // Update immediately and then every second
            updateCounter();
            const countdownInterval = setInterval(updateCounter, 1000);
        }

        function openMembershipModal() {
            // For now, redirect to socio dashboard
            navigateTo('socio');

            // Optional: show a success message
            setTimeout(() => {
                alert('üéâ ¬°Bienvenido al Club Elite! Tu membres√≠a gratuita ha sido activado por 30 d√≠as.');
            }, 500);
        }

        // Initialize countdown on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', startMembershipCountdown);
        } else {
            startMembershipCountdown();
        }

        // --- COMPACT AI CHAT LOGIC ---
        function sendCompactChat(message) {
            const messagesDiv = document.getElementById('compact-messages');

            // Add user message
            messagesDiv.insertAdjacentHTML('beforeend', `
                <div class="flex gap-3 items-start justify-end">
                    <div class="bg-primary text-white rounded-2xl rounded-tr-sm p-3 shadow-sm max-w-[70%]">
                        <p class="text-[11px] font-medium">${message}</p>
                    </div>
                    <div class="w-8 h-8 bg-slate-200 rounded-xl flex items-center justify-center flex-shrink-0">
                        <i class="ri-user-fill text-slate-600 text-sm"></i>
                    </div>
                </div>
            `);

            // Scroll to bottom
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            // Generate AI response after delay
            setTimeout(() => {
                const response = generateCompactResponse(message.toLowerCase());
                messagesDiv.insertAdjacentHTML('beforeend', response);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 800);
        }

        function sendCompactChatFromInput() {
            const input = document.getElementById('compact-input');
            const message = input.value.trim();
            if (!message) return;

            sendCompactChat(message);
            input.value = '';
        }

        function generateCompactResponse(message) {
            let responseHTML = '';

            // Trekking / Monta√±a
            if (message.includes('trek') || message.includes('monta√±a') || message.includes('monta√±ismo')) {
                const trekkingTours = tours.filter(t => t.dept === 'Cusco' || t.dept === 'Huaraz');
                responseHTML = `
                    <p class="text-slate-800 text-xs font-semibold mb-3">üèîÔ∏è Estas son las mejores rutas:</p>
                    ${trekkingTours.slice(0, 2).map(tour => `
                        <div class="bg-slate-50 rounded-xl p-3 mb-2 border border-slate-100 hover:border-primary transition-all cursor-pointer" onclick="showTourDetailsInChat(${tour.id})">
                            <div class="flex items-center gap-2 mb-2">
                                <img src="${tour.img}?w=60" class="w-10 h-10 rounded-lg object-cover">
                                <div class="flex-1">
                                    <p class="text-[10px] font-black text-primary">${tour.title}</p>
                                    <p class="text-[8px] text-slate-500">${tour.dept} ‚Ä¢ ${tour.duration}</p>
                                </div>
                                <p class="text-[11px] font-black text-slate-800">$${tour.price}</p>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="event.stopPropagation(); showTourDetailsInChat(${tour.id})" class="bg-white border border-primary text-primary px-2 py-1 rounded-lg text-[8px] font-black hover:bg-primary hover:text-white transition-all">
                                    üìã Ver Info
                                </button>
                                <button onclick="event.stopPropagation(); openBooking(${tour.id})" class="bg-primary text-white px-2 py-1 rounded-lg text-[8px] font-black hover:bg-slate-900 transition-all">
                                    ‚úÖ Reservar
                                </button>
                            </div>
                        </div>
                    `).join('')}
                    <button onclick="navigateTo('destinos')" class="mt-2 w-full bg-primary text-white px-3 py-2 rounded-xl text-[9px] font-black uppercase hover:bg-slate-900 transition-all">
                        Ver Todos los Destinos ‚Üí
                    </button>
                `;
            }

            // Selva / Amazonas
            else if (message.includes('selva') || message.includes('amazonas') || message.includes('jungle') || message.includes('iquitos')) {
                const jungleTours = tours.filter(t => t.dept === 'Iquitos' || t.dept === 'Madre de Dios');
                if (jungleTours.length > 0) {
                    responseHTML = `
                        <p class="text-slate-800 text-xs font-semibold mb-3">üå¥ Aventuras en la selva:</p>
                        ${jungleTours.map(tour => `
                            <div class="bg-slate-50 rounded-xl p-3 mb-2 border border-slate-100">
                                <div class="flex items-center gap-2 mb-2">
                                    <img src="${tour.img}?w=60" class="w-10 h-10 rounded-lg object-cover">
                                    <div class="flex-1">
                                        <p class="text-[10px] font-black text-secondary">${tour.title}</p>
                                        <p class="text-[8px] text-slate-500">${tour.duration} ‚Ä¢ ${tour.difficulty}</p>
                                    </div>
                                    <p class="text-[11px] font-black text-slate-800">$${tour.price}</p>
                                </div>
                                <div class="grid grid-cols-2 gap-2">
                                    <button onclick="showTourDetailsInChat(${tour.id})" class="bg-white border border-secondary text-secondary px-2 py-1 rounded-lg text-[8px] font-black">
                                        üìã Detalles
                                    </button>
                                    <button onclick="openBooking(${tour.id})" class="bg-secondary text-white px-2 py-1 rounded-lg text-[8px] font-black">
                                        ‚úÖ Reservar
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    `;
                } else {
                    responseHTML = `<p class="text-slate-600 text-xs">Pr√≥ximamente expediciones de selva en Iquitos.</p>`;
                }
            }

            // Equipamiento
            else if (message.includes('equip') || message.includes('mochila') || message.includes('gear') || message.includes('ropa')) {
                responseHTML = `
                    <p class="text-slate-800 text-xs font-semibold mb-3">üéí Equipamiento de elite:</p>
                    <div class="space-y-2 mb-3">
                        <div class="bg-slate-50 rounded-xl p-3 border border-slate-100">
                            <p class="text-[10px] font-black text-accent mb-1">Mochilas T√©cnicas</p>
                            <p class="text-[8px] text-slate-600">Desde 40L hasta 80L para expediciones largas</p>
                        </div>
                        <div class="bg-slate-50 rounded-xl p-3 border border-slate-100">
                            <p class="text-[10px] font-black text-accent mb-1">Carpas 4 Estaciones</p>
                            <p class="text-[8px] text-slate-600">Resistentes a condiciones extremas</p>
                        </div>
                        <div class="bg-slate-50 rounded-xl p-3 border border-slate-100">
                            <p class="text-[10px] font-black text-accent mb-1">Calzado Especializado</p>
                            <p class="text-[8px] text-slate-600">Botas de trekking y monta√±ismo</p>
                        </div>
                    </div>
                    <button onclick="navigateTo('equipos')" class="w-full bg-accent text-white px-3 py-2 rounded-xl text-[9px] font-black uppercase hover:bg-orange-600 transition-all">
                        Ver Cat√°logo Completo ‚Üí
                    </button>
                `;
            }

            // Ver tour espec√≠fico por nombre
            else if (message.includes('salkantay') || message.includes('huayhuash') || message.includes('pisco') || message.includes('paracas')) {
                const tourName = message.includes('salkantay') ? 'Salkantay' :
                    message.includes('huayhuash') ? 'Huayhuash' :
                        message.includes('pisco') ? 'Pisco' : 'Paracas';
                const tour = tours.find(t => t.title.toLowerCase().includes(tourName.toLowerCase()));

                if (tour) {
                    responseHTML = generateTourDetailHTML(tour);
                } else {
                    responseHTML = `<p class="text-slate-600 text-xs">No encontr√© informaci√≥n sobre ese tour. ¬øTe gustar√≠a ver todos los destinos disponibles?</p>`;
                }
            }

            // Precios / Presupuesto
            else if (message.includes('precio') || message.includes('costo') || message.includes('cuanto') || message.includes('presupuesto')) {
                const cheapTours = tours.filter(t => t.price < 500).slice(0, 2);
                const expensiveTours = tours.filter(t => t.price >= 500).slice(0, 2);

                responseHTML = `
                    <p class="text-slate-800 text-xs font-semibold mb-3">üí∞ Opciones por presupuesto:</p>
                    <div class="mb-3">
                        <p class="text-[9px] font-black text-slate-600 mb-2">ECON√ìMICO (menos de $500)</p>
                        ${cheapTours.map(tour => `
                            <div class="bg-emerald-50 rounded-lg p-2 mb-1 flex items-center justify-between">
                                <p class="text-[9px] font-bold text-slate-800">${tour.title}</p>
                                <button onclick="openBooking(${tour.id})" class="text-[8px] font-black text-secondary">Reservar ‚Üí</button>
                            </div>
                        `).join('')}
                    </div>
                    <div>
                        <p class="text-[9px] font-black text-slate-600 mb-2">PREMIUM ($500+)</p>
                        ${expensiveTours.map(tour => `
                            <div class="bg-indigo-50 rounded-lg p-2 mb-1 flex items-center justify-between">
                                <p class="text-[9px] font-bold text-slate-800">${tour.title}</p>
                                <button onclick="openBooking(${tour.id})" class="text-[8px] font-black text-primary">Reservar ‚Üí</button>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Sorpr√©ndeme
            else if (message.includes('sorpre') || message.includes('no s√©') || message.includes('recomienda')) {
                const randomTour = tours[Math.floor(Math.random() * tours.length)];
                responseHTML = generateTourDetailHTML(randomTour, '‚ú® Te recomiendo esta aventura incre√≠ble:');
            }

            // Eventos
            else if (message.includes('evento') || message.includes('competencia') || message.includes('festival') || message.includes('carrera')) {
                responseHTML = `
                    <p class="text-slate-800 text-xs font-semibold mb-3">üèÜ Pr√≥ximos eventos 2026:</p>
                    <div class="space-y-2 mb-3">
                        <div class="bg-amber-50 rounded-xl p-3 border border-amber-200">
                            <p class="text-[10px] font-black text-amber-700">Ultra Trail Cusco</p>
                            <p class="text-[8px] text-slate-600">Marzo 2026 ‚Ä¢ 100km</p>
                        </div>
                        <div class="bg-blue-50 rounded-xl p-3 border border-blue-200">
                            <p class="text-[10px] font-black text-blue-700">Huaraz Climbing Festival</p>
                            <p class="text-[8px] text-slate-600">Junio 2026 ‚Ä¢ 5 d√≠as</p>
                        </div>
                    </div>
                    <button onclick="navigateTo('eventos')" class="w-full bg-accent text-white px-3 py-2 rounded-xl text-[9px] font-black uppercase">
                        Ver Calendario ‚Üí
                    </button>
                `;
            }

            // Gu√≠as
            else if (message.includes('gu√≠a') || message.includes('guias') || message.includes('instructor')) {
                responseHTML = `
                    <p class="text-slate-800 text-xs font-semibold mb-3">üë®‚Äçüè´ Nuestros gu√≠as certificados:</p>
                    <p class="text-[10px] text-slate-600 mb-3">Contamos con gu√≠as UIAGM/IFMGA especializados en alta monta√±a, selva y costa.</p>
                    <button onclick="navigateTo('guias')" class="w-full bg-primary text-white px-3 py-2 rounded-xl text-[9px] font-black uppercase">
                        Conocer al Staff ‚Üí
                    </button>
                `;
            }

            // Default
            else {
                responseHTML = `
                    <p class="text-slate-800 text-xs font-semibold mb-3">¬øQu√© te gustar√≠a hacer?</p>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="sendCompactChat('Ver todos los tours')" class="bg-indigo-50 hover:bg-indigo-100 p-2 rounded-lg text-[9px] font-bold transition-all">üó∫Ô∏è Ver Tours</button>
                        <button onclick="sendCompactChat('Equipamiento')" class="bg-orange-50 hover:bg-orange-100 p-2 rounded-lg text-[9px] font-bold transition-all">üéí Equipo</button>
                        <button onclick="sendCompactChat('Eventos')" class="bg-amber-50 hover:bg-amber-100 p-2 rounded-lg text-[9px] font-bold transition-all">üèÜ Eventos</button>
                        <button onclick="sendCompactChat('Gu√≠as profesionales')" class="bg-emerald-50 hover:bg-emerald-100 p-2 rounded-lg text-[9px] font-bold transition-all">üë®‚Äçüè´ Gu√≠as</button>
                    </div>
                `;
            }

            return `
                <div class="flex gap-3 items-start">
                    <div class="w-8 h-8 bg-gradient-to-br from-primary to-accent rounded-xl flex items-center justify-center text-white flex-shrink-0">
                        <i class="ri-sparkling-fill text-sm"></i>
                    </div>
                    <div class="flex-1 bg-white rounded-2xl rounded-tl-sm p-4 shadow-sm border border-slate-100">
                        ${responseHTML}
                    </div>
                </div>
            `;
        }

        // Generate detailed tour information
        function generateTourDetailHTML(tour, header = 'üìç Informaci√≥n del tour:') {
            return `
                <p class="text-slate-800 text-xs font-semibold mb-3">${header}</p>
                <div class="bg-gradient-to-br from-slate-50 to-indigo-50 rounded-xl p-4 mb-3 border border-slate-200">
                    <img src="${tour.img}?w=300" class="w-full h-24 object-cover rounded-lg mb-3">
                    <h4 class="text-sm font-black text-primary mb-2">${tour.title}</h4>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <div class="bg-white/80 rounded-lg p-2">
                            <p class="text-[8px] text-slate-500 font-bold">Ubicaci√≥n</p>
                            <p class="text-[10px] font-black text-slate-800">üìç ${tour.dept}</p>
                        </div>
                        <div class="bg-white/80 rounded-lg p-2">
                            <p class="text-[8px] text-slate-500 font-bold">Duraci√≥n</p>
                            <p class="text-[10px] font-black text-slate-800">‚è±Ô∏è ${tour.duration}</p>
                        </div>
                        <div class="bg-white/80 rounded-lg p-2">
                            <p class="text-[8px] text-slate-500 font-bold">Dificultad</p>
                            <p class="text-[10px] font-black text-slate-800">‚≠ê ${tour.difficulty}</p>
                        </div>
                        <div class="bg-white/80 rounded-lg p-2">
                            <p class="text-[8px] text-slate-500 font-bold">Precio</p>
                            <p class="text-[10px] font-black text-accent">üí∞ $${tour.price}</p>
                        </div>
                    </div>
                    <p class="text-[9px] text-slate-600 leading-relaxed mb-3">${tour.itinerary ? tour.itinerary[0] : 'Expedici√≥n completa con gu√≠a certificado, equipamiento y alimentaci√≥n incluidos.'}</p>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="showFullItinerary(${tour.id})" class="bg-white border-2 border-primary text-primary px-3 py-2 rounded-xl text-[9px] font-black hover:bg-primary hover:text-white transition-all">
                            üìã Ver Itinerario
                        </button>
                        <button onclick="openBooking(${tour.id})" class="bg-primary text-white px-3 py-2 rounded-xl text-[9px] font-black hover:bg-slate-900 transition-all">
                            ‚úÖ Reservar Ahora
                        </button>
                    </div>
                </div>
            `;
        }

        // Show tour details in chat
        function showTourDetailsInChat(tourId) {
            const tour = tours.find(t => t.id === tourId);
            if (!tour) return;

            const messagesDiv = document.getElementById('compact-messages');
            messagesDiv.insertAdjacentHTML('beforeend', `
                <div class="flex gap-3 items-start justify-end">
                    <div class="bg-primary text-white rounded-2xl rounded-tr-sm p-3 shadow-sm max-w-[70%]">
                        <p class="text-[11px] font-medium">Ver detalles de ${tour.title}</p>
                    </div>
                    <div class="w-8 h-8 bg-slate-200 rounded-xl flex items-center justify-center flex-shrink-0">
                        <i class="ri-user-fill text-slate-600 text-sm"></i>
                    </div>
                </div>
            `);

            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            setTimeout(() => {
                messagesDiv.insertAdjacentHTML('beforeend', `
                    <div class="flex gap-3 items-start">
                        <div class="w-8 h-8 bg-gradient-to-br from-primary to-accent rounded-xl flex items-center justify-center text-white flex-shrink-0">
                            <i class="ri-sparkling-fill text-sm"></i>
                        </div>
                        <div class="flex-1 bg-white rounded-2xl rounded-tl-sm p-4 shadow-sm border border-slate-100">
                            ${generateTourDetailHTML(tour)}
                        </div>
                    </div>
                `);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 500);
        }

        // Show full itinerary (opens booking modal with tour details)
        function showFullItinerary(tourId) {
            openBooking(tourId);
        }

    </script>
</body>

</html>