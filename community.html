<!DOCTYPE html>
<html lang="es">

<head>
    <!-- Google Analytics 4 (GA4) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KW625TWP91"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-KW625TWP91');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lifextreme Social | La Revoluci√≥n del Viaje</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Outfit:wght@100..900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4338ca',
                        secondary: '#f43f5e',
                        accent: '#ffbf00',
                        dark: '#0f172a'
                    },
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                        heading: ['Montserrat', 'sans-serif']
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-900 text-white selection:bg-primary selection:text-white">

    <!-- HEADER SIMPLE -->
    <header class="fixed top-0 w-full z-50 bg-slate-900/80 backdrop-blur-md border-b border-white/5">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="flex items-center group">
                <div
                    class="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center text-white border border-white/20 group-hover:bg-primary transition-all">
                    <i class="ri-arrow-left-line text-xl"></i>
                </div>
            </a>
            <div class="text-center">
                <p class="text-[10px] font-black uppercase tracking-[0.3em] text-primary">Project Launch</p>
                <h1 class="font-black italic text-xl">SOCIAL <span
                        class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary">EXPEDITIONS</span>
                </h1>
            </div>
            <div class="w-10"></div> <!-- Spacer -->
        </div>
    </header>

    <main>
        <!-- HERO SECTION -->
        <section class="relative pt-32 pb-20 overflow-hidden">
            <!-- Background Elements -->
            <div
                class="absolute top-0 left-1/2 -translate-x-1/2 w-[800px] h-[800px] bg-primary/20 rounded-full blur-[120px] -z-10">
            </div>

            <div class="container mx-auto px-6 text-center relative z-10">
                <span
                    class="inline-block py-1 px-3 rounded-full bg-white/5 border border-white/10 text-[10px] font-black uppercase tracking-widest mb-6 animate-pulse text-accent">
                    üöÄ Pr√≥ximamente - Beta Access
                </span>
                <h2 class="text-5xl md:text-7xl font-black italic leading-[0.9] mb-8">
                    Viaja M√°s.<br>
                    <span
                        class="text-transparent bg-clip-text bg-gradient-to-r from-primary via-secondary to-accent">Paga
                        Menos.</span>
                </h2>
                <p class="text-slate-400 max-w-2xl mx-auto text-lg mb-12 font-medium">
                    La plataforma que democratiza la aventura. Crea grupos, divide gastos y accede a log√≠stica
                    profesional sin intermediarios caros.
                </p>
            </div>
        </section>

        <!-- SOCIAL APP INTERFACE -->
        <div class="container mx-auto px-6 pb-32" id="app-interface">

            <!-- TABS NAVIGATION -->
            <div class="flex flex-wrap justify-center gap-4 mb-16">
                <button onclick="switchTab('lobby')" id="tab-btn-lobby"
                    class="bg-primary text-white px-8 py-3 rounded-2xl font-black uppercase tracking-widest shadow-lg shadow-primary/20 transition-all hover:scale-105 border-2 border-primary">
                    <i class="ri-compass-3-line mr-2"></i> Explorar Lobby
                </button>
                <button onclick="switchTab('create')" id="tab-btn-create"
                    class="bg-slate-800 text-slate-400 px-8 py-3 rounded-2xl font-black uppercase tracking-widest hover:text-white hover:bg-slate-700 transition-all border-2 border-transparent">
                    <i class="ri-add-circle-line mr-2"></i> Crear Expedici√≥n
                </button>
                <button onclick="switchTab('operator')" id="tab-btn-operator"
                    class="bg-slate-800 text-slate-400 px-8 py-3 rounded-2xl font-black uppercase tracking-widest hover:text-white hover:bg-slate-700 transition-all border-2 border-transparent">
                    <i class="ri-shield-flash-line mr-2"></i> Zona Operadores
                </button>
            </div>

            <!-- VIEW: LOBBY (Find Tribes) -->
            <div id="view-lobby" class="animate-fade-in">
                <div class="flex justify-between items-end mb-8">
                    <div>
                        <h3 class="text-3xl font-black italic">Expediciones Activas</h3>
                        <p class="text-slate-400 text-sm mt-2">√önete a un grupo y comparte gastos. Si no encuentras tu
                            fecha, ¬°cr√©ala!</p>
                    </div>

                    <!-- Simple Filter -->
                    <div class="hidden md:flex gap-2">
                        <select
                            class="bg-slate-800 border-none rounded-xl px-4 py-2 text-xs font-bold text-white outline-none">
                            <option>Todas las Regiones</option>
                            <option>Cusco</option>
                            <option>Huaraz</option>
                            <option>Arequipa</option>
                        </select>
                    </div>
                </div>

                <!-- Grid Container -->
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="expeditions-grid">
                    <!-- Cards injected via JS -->
                </div>
            </div>

            <!-- VIEW: CREATE (Leader Mode) -->
            <div id="view-create" class="hidden animate-fade-in">
                <div
                    class="max-w-4xl mx-auto bg-slate-800 rounded-[40px] p-8 md:p-12 border border-slate-700 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-primary/10 rounded-full blur-[80px] -z-10"></div>

                    <div class="text-center mb-10">
                        <span
                            class="text-[10px] font-black uppercase text-secondary tracking-widest border border-secondary/30 px-3 py-1 rounded-full">L√≠der
                            de Expedici√≥n</span>
                        <h3 class="text-3xl md:text-4xl font-black italic mt-4">Convoca a tu Tribu</h3>
                        <p class="text-slate-400 text-sm mt-2 max-w-lg mx-auto">T√∫ pones las reglas y la fecha. Nosotros
                            ponemos la plataforma y la log√≠stica.</p>
                    </div>

                    <form onsubmit="event.preventDefault(); createExpedition();" class="space-y-8">
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="space-y-2">
                                <label class="text-[10px] font-black uppercase text-slate-400">Objetivo
                                    (Destino)</label>
                                <select id="new-target"
                                    class="w-full bg-slate-900 border border-slate-700 rounded-2xl px-6 py-4 text-sm font-bold focus:border-primary outline-none text-white appearance-none cursor-pointer">
                                    <option value="" disabled selected>Selecciona una Ruta</option>
                                    <option value="Ausangate 4D">Ausangate Circuit 4D</option>
                                    <option value="Salkantay 5D">Salkantay Trek 5D</option>
                                    <option value="Choquequirao 4D">Choquequirao Cl√°sico 4D</option>
                                    <option value="Huayhuash 8D">Cordillera Huayhuash 8D</option>
                                    <option value="Misti 2D">Cumbre Volc√°n Misti 2D</option>
                                </select>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] font-black uppercase text-slate-400">Fecha de Inicio</label>
                                <input type="date" id="new-date"
                                    class="w-full bg-slate-900 border border-slate-700 rounded-2xl px-6 py-4 text-sm font-bold focus:border-primary outline-none text-white [color-scheme:dark]">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="col-span-2 space-y-2">
                                <label class="text-[10px] font-black uppercase text-slate-400">Presupuesto Meta
                                    (S/)</label>
                                <input type="number" id="new-budget" placeholder="Ej: 850"
                                    class="w-full bg-slate-900 border border-slate-700 rounded-2xl px-6 py-4 text-sm font-bold focus:border-primary outline-none text-white">
                                <p class="text-[9px] text-slate-500">*Sugerido por IA: S/ 800 - 950</p>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] font-black uppercase text-slate-400">Min. Pax</label>
                                <input type="number" id="new-min" value="4" min="2"
                                    class="w-full bg-slate-900 border border-slate-700 rounded-2xl px-6 py-4 text-sm font-bold focus:border-primary outline-none text-white text-center">
                            </div>
                            <div class="space-y-2">
                                <label class="text-[10px] font-black uppercase text-slate-400">Max. Pax</label>
                                <input type="number" id="new-max" value="8" min="2"
                                    class="w-full bg-slate-900 border border-slate-700 rounded-2xl px-6 py-4 text-sm font-bold focus:border-primary outline-none text-white text-center">
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label class="text-[10px] font-black uppercase text-slate-400">Manifiesto del Grupo
                                (Descripci√≥n)</label>
                            <textarea id="new-desc" rows="3"
                                placeholder="Ej: Buscamos gente relajada, ritmo medio, fot√≥grafos bienvenidos..."
                                class="w-full bg-slate-900 border border-slate-700 rounded-2xl px-6 py-4 text-sm font-medium focus:border-primary outline-none text-white resize-none"></textarea>
                        </div>

                        <button type="submit"
                            class="w-full bg-gradient-to-r from-primary to-secondary hover:brightness-110 text-white py-5 rounded-2xl font-black uppercase tracking-widest shadow-xl shadow-primary/20 transition-all flex items-center justify-center gap-3">
                            Lanzar Expedici√≥n <i class="ri-rocket-2-fill"></i>
                        </button>
                    </form>
                </div>
            </div>

            <!-- VIEW: OPERATOR (Uber Mode) -->
            <div id="view-operator" class="hidden animate-fade-in">
                <div class="bg-emerald-900/20 border border-emerald-500/20 rounded-[40px] p-8 mb-8 text-center">
                    <h3 class="text-2xl font-black italic text-emerald-400">Panel de Control Operativo</h3>
                    <p class="text-slate-400 text-sm mt-2">Acepta grupos listos ("Ready to Deploy") y obt√©n servicios
                        confirmados sin gastos de marketing.</p>
                </div>

                <div class="space-y-4" id="operators-list">
                    <!-- Operator Cards injected JS -->
                </div>
            </div>

        </div>

        <script>
            // --- DATA STORE & UBER PRICING LOGIC ---

            // Base Costs Database (Market Intelligence)
            const ROUTE_DATA = {
                "Ausangate 4D": { base: 650, recommended: 850, high: 1200 },
                "Salkantay 5D": { base: 750, recommended: 950, high: 1300 },
                "Choquequirao 4D": { base: 800, recommended: 1100, high: 1500 },
                "Huayhuash 8D": { base: 1400, recommended: 1800, high: 2500 },
                "Misti 2D": { base: 350, recommended: 450, high: 600 }
            };

            // In a real app, this comes from Supabase
            let expeditions = [
                {
                    id: 101,
                    leader: "Alejandro",
                    avatar: "https://randomuser.me/api/portraits/men/32.jpg",
                    target: "Ausangate Circuit 4D",
                    date: "2026-03-15",
                    budget: 850,
                    minPax: 4,
                    maxPax: 8,
                    currentPax: 6,
                    desc: "Ritmo fotogr√°fico, amaneceres √©picos. ¬°Faltan 2 para cerrar!",
                    status: "active"
                },
                {
                    id: 102,
                    leader: "Sarah",
                    avatar: "https://randomuser.me/api/portraits/women/44.jpg",
                    target: "Salkantay Trek 5D",
                    date: "2026-04-10",
                    budget: 700, // Low budget example
                    minPax: 6,
                    maxPax: 10,
                    currentPax: 2,
                    desc: "Grupo internacional (ESP/ENG). Buscamos buen rollo.",
                    status: "active"
                },
                {
                    id: 103,
                    leader: "Team Alpha",
                    avatar: "https://randomuser.me/api/portraits/men/85.jpg",
                    target: "Huayhuash 8D",
                    date: "2026-05-01",
                    budget: 1800, // High budget example
                    minPax: 8,
                    maxPax: 12,
                    currentPax: 8,
                    desc: "Expedici√≥n seria. Entrenamiento previo requerido.",
                    status: "ready"
                }
            ];

            // --- PRICING ALGORITHM ---

            function calculateMatchProbability(target, budget) {
                const data = ROUTE_DATA[target];
                if (!data) return { score: 0, label: "Desconocido", color: "text-slate-500" };

                if (budget < data.base) return { score: 10, label: "Muy Baja (Dif√≠cil encontrar operador)", color: "text-red-500", icon: "ri-error-warning-fill" };
                if (budget < data.recommended) return { score: 40, label: "Moderada (Posible demora)", color: "text-amber-500", icon: "ri-time-line" };
                if (budget < data.high) return { score: 85, label: "Alta (Operador Inmediato)", color: "text-emerald-500", icon: "ri-flashlight-fill" };
                return { score: 99, label: "Premium (Conductores pelear√°n por ti)", color: "text-purple-500", icon: "ri-vip-diamond-fill" };
            }

            // --- UI LIVE FEEDBACK ---

            // Listeners for Smart Form
            document.addEventListener('DOMContentLoaded', () => {
                const targetSelect = document.getElementById('new-target');
                const budgetInput = document.getElementById('new-budget');

                // Inject feedback element if missing
                if (budgetInput && !document.getElementById('budget-feedback')) {
                    const div = document.createElement('div');
                    div.id = 'budget-feedback';
                    div.className = 'mt-2 text-xs font-bold transition-all';
                    budgetInput.parentNode.appendChild(div);
                }

                function updateProbability() {
                    const t = targetSelect.value;
                    const b = parseInt(budgetInput.value);
                    const el = document.getElementById('budget-feedback');

                    if (!t || isNaN(b)) {
                        if (el) el.innerHTML = "";
                        return;
                    }

                    const prob = calculateMatchProbability(t, b);
                    el.className = `mt-3 text-xs font-black uppercase flex items-center gap-2 ${prob.color}`;
                    el.innerHTML = `<i class="${prob.icon} text-lg"></i> Probabilidad de Match: ${prob.label}`;
                }

                if (targetSelect && budgetInput) {
                    targetSelect.addEventListener('change', () => {
                        const t = targetSelect.value;
                        const range = ROUTE_DATA[t];
                        if (range) {
                            const hint = document.querySelector('#new-budget + p');
                            if (hint) hint.innerText = `*Rango sugerido Mercado: S/ ${range.base} - S/ ${range.recommended}`;
                        }
                        updateProbability();
                    });
                    budgetInput.addEventListener('input', updateProbability);
                }

                // Init render
                renderLobby();
            });

            // --- RENDER LOGIC ---
            function renderLobby() {
                const grid = document.getElementById('expeditions-grid');
                if (!grid) return;

                grid.innerHTML = expeditions.filter(e => e.status !== 'completed').map(e => {
                    const prob = calculateMatchProbability(e.target, e.budget);

                    return `
                    <div class="bg-slate-800 rounded-[32px] p-6 border border-slate-700 hover:border-primary transition-all group relative overflow-hidden">
                        ${e.status === 'ready' ?
                            `<div class="absolute top-0 right-0 bg-emerald-500 text-white text-[9px] font-black uppercase px-3 py-1 rounded-bl-xl z-20 shadow-lg">Listo para Despegue</div>` : ''}
                        
                        <div class="flex items-center gap-4 mb-6">
                            <img src="${e.avatar}" class="w-12 h-12 rounded-full border-2 border-primary">
                            <div>
                                <p class="text-[10px] font-black text-slate-400 uppercase">L√≠der: ${e.leader}</p>
                                <h4 class="font-bold text-white leading-tight">${e.target}</h4>
                            </div>
                        </div>

                        <div class="space-y-4 mb-6">
                             <div class="flex justify-between items-center text-sm p-3 bg-slate-900 rounded-xl border border-slate-700">
                                <span class="text-slate-400 text-xs uppercase font-bold">Oferta al Operador</span>
                                <div class="text-right">
                                    <span class="font-black text-accent block">S/ ${e.budget} <span class="text-[9px] text-slate-500">p/p</span></span>
                                    <span class="text-[9px] font-bold ${prob.color}"><i class="${prob.icon}"></i> ${prob.score}% Match</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-slate-400"><i class="ri-calendar-event-line mr-2"></i>Inicio:</span>
                                <span class="font-bold text-white">${e.date}</span>
                            </div>
                        </div>

                        <!-- PROGRESS BAR -->
                        <div class="mb-2 flex justify-between text-[10px] font-black uppercase">
                            <span class="${e.currentPax >= e.minPax ? 'text-emerald-400' : 'text-slate-500'}">${e.currentPax} Confirmados</span>
                            <span class="text-slate-500">Meta: ${e.minPax} - ${e.maxPax}</span>
                        </div>
                        <div class="w-full bg-slate-900 h-2 rounded-full overflow-hidden mb-6">
                            <div class="h-full ${e.currentPax >= e.minPax ? 'bg-emerald-500' : 'bg-primary'} transition-all duration-1000" style="width: ${(e.currentPax / e.maxPax) * 100}%"></div>
                        </div>

                        <p class="text-xs text-slate-400 italic mb-6 line-clamp-2">"${e.desc}"</p>

                        <div class="grid grid-cols-5 gap-2">
                            <button onclick="shareLink(${e.id})" class="col-span-1 bg-slate-700 hover:bg-slate-600 text-white rounded-xl flex items-center justify-center transition-colors">
                                <i class="ri-share-forward-line"></i>
                            </button>
                            ${e.status === 'ready' || e.currentPax >= e.maxPax ?
                            `<button disabled class="col-span-4 bg-slate-700 text-slate-500 font-black uppercase text-xs rounded-xl py-3 cursor-not-allowed">Grupo Lleno / Cerrado</button>` :
                            `<button onclick="joinGroup(${e.id})" class="col-span-4 bg-white text-slate-900 font-black uppercase text-xs rounded-xl py-3 hover:bg-slate-200 transition-colors">Unirme por S/ ${e.budget}</button>`
                        }
                        </div>
                    </div>
                `}).join('');
            }

            function renderOperators() {
                const list = document.getElementById('operators-list');
                // Filter only READY groups
                const readyGroups = expeditions.filter(e => e.status === 'ready' || (e.currentPax >= e.minPax && e.status !== 'completed'));

                if (readyGroups.length === 0) {
                    list.innerHTML = `<div class="text-center py-12 opacity-50"><i class="ri-zzz-line text-4xl"></i><p>No hay grupos listos para operar en este momento.</p></div>`;
                    return;
                }

                // Sort by TOTAL VALUE (Uber Logic: Show highest paying gigs first)
                readyGroups.sort((a, b) => (b.currentPax * b.budget) - (a.currentPax * a.budget));

                list.innerHTML = readyGroups.map(e => {
                    const totalValue = e.currentPax * e.budget;
                    const data = ROUTE_DATA[e.target] || { base: 0 };
                    const estimatedCost = e.currentPax * (data.base * 0.85); // Estimated pure operational cost (optimistic)
                    const potentialProfit = totalValue - estimatedCost;
                    const profitabilityScore = data.base > 0 ? Math.min(100, Math.round((potentialProfit / totalValue) * 100)) : 0;

                    return `
                    <div class="bg-slate-800 rounded-[32px] p-6 lg:p-8 flex flex-col md:flex-row items-center gap-6 border border-emerald-500/30 shadow-lg shadow-emerald-500/5 relative overflow-hidden group">
                        <!-- Background Glow for High Value -->
                        ${profitabilityScore > 30 ? '<div class="absolute top-0 right-0 w-64 h-64 bg-emerald-500/10 rounded-full blur-[80px] -z-10 group-hover:bg-emerald-500/20 transition-all"></div>' : ''}

                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <span class="bg-emerald-500/20 text-emerald-400 text-[10px] font-black uppercase px-2 py-1 rounded">Alta Demanda</span>
                                <h4 class="text-2xl font-black italic text-white">${e.target}</h4>
                            </div>
                            <div class="grid grid-cols-3 gap-4 text-sm text-slate-300 mb-4">
                                <div>
                                    <p class="text-[9px] uppercase text-slate-500">Fecha</p>
                                    <p class="font-bold text-white"><i class="ri-calendar-line text-emerald-500"></i> ${e.date}</p>
                                </div>
                                <div>
                                    <p class="text-[9px] uppercase text-slate-500">Volumen</p>
                                    <p class="font-bold text-white"><i class="ri-group-line text-emerald-500"></i> ${e.currentPax} Pax</p>
                                </div>
                                <div>
                                    <p class="text-[9px] uppercase text-slate-500">Pago Unit.</p>
                                    <p class="font-bold text-white"><i class="ri-wallet-3-line text-emerald-500"></i> S/ ${e.budget}</p>
                                </div>
                            </div>
                            <p class="text-xs text-slate-500 italic">"Garantizado por Lifextreme: El grupo ya cubri√≥ la cuota m√≠nima."</p>
                        </div>

                        <div class="w-full md:w-auto bg-slate-900 rounded-2xl p-6 border border-slate-700 min-w-[280px]">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-[10px] font-black uppercase text-slate-400">Pago Total Asegurado</span>
                                <span class="bg-emerald-500 text-slate-900 text-[10px] font-black px-2 py-0.5 rounded">NETO</span>
                            </div>
                            <p class="text-4xl font-black text-white italic mb-4 tracking-tighter">S/ ${totalValue}</p>
                            
                            <div class="space-y-3">
                                <div class="flex justify-between text-[10px] text-slate-400">
                                    <span>Rentabilidad Est.</span>
                                    <span class="${profitabilityScore > 20 ? 'text-green-400' : 'text-amber-400'} font-bold">${profitabilityScore}% Margen</span>
                                </div>
                                <div class="w-full bg-slate-800 h-1.5 rounded-full overflow-hidden">
                                     <div class="h-full ${profitabilityScore > 20 ? 'bg-green-500' : 'bg-amber-500'}" style="width: ${profitabilityScore}%"></div>
                                </div>
                            </div>

                            <button onclick="operatorAccept(${e.id})" class="mt-6 bg-white hover:bg-slate-200 text-slate-900 font-black uppercase px-6 py-4 rounded-xl transition-all w-full shadow-lg shadow-white/5">
                                <i class="ri-flashlight-fill mr-1 text-amber-500"></i> Aceptar Viaje
                            </button>
                        </div>
                    </div>
                `}).join('');
            }

            // --- ACTIONS ---
            function switchTab(tab) {
                // Update Buttons
                ['lobby', 'create', 'operator'].forEach(t => {
                    const btn = document.getElementById(`tab-btn-${t}`);
                    const view = document.getElementById(`view-${t}`);

                    if (t === tab) {
                        btn.classList.remove('bg-slate-800', 'text-slate-400', 'border-transparent');
                        btn.classList.add('bg-primary', 'text-white', 'border-primary', 'shadow-lg');
                        view.classList.remove('hidden');
                    } else {
                        btn.classList.add('bg-slate-800', 'text-slate-400', 'border-transparent');
                        btn.classList.remove('bg-primary', 'text-white', 'border-primary', 'shadow-lg');
                        view.classList.add('hidden');
                    }
                });

                if (tab === 'lobby') renderLobby();
                if (tab === 'operator') renderOperators();
            }

            function createExpedition() {
                const target = document.getElementById('new-target').value;
                const date = document.getElementById('new-date').value;
                const budget = document.getElementById('new-budget').value;
                const min = document.getElementById('new-min').value;
                const max = document.getElementById('new-max').value;
                const desc = document.getElementById('new-desc').value;

                if (!target || !date || !budget) {
                    alert('Por favor completa los campos principales de la misi√≥n.');
                    return;
                }

                const newExp = {
                    id: Date.now(),
                    leader: "T√∫ (L√≠der)",
                    avatar: "https://ui-avatars.com/api/?name=User&background=random",
                    target: target,
                    date: date,
                    budget: parseInt(budget),
                    minPax: parseInt(min),
                    maxPax: parseInt(max),
                    currentPax: 1, // Start with creator
                    desc: desc,
                    status: 'active'
                };

                expeditions.unshift(newExp); // Add to top

                // Check probability for immediate feedback
                const prob = calculateMatchProbability(target, newExp.budget);
                let msg = '¬°Expedici√≥n Creada!';
                if (prob.score < 40) msg += '\n‚ö†Ô∏è Nota: Tu presupuesto es bajo, puede tardar en llenarse o encontrar operador.';
                else if (prob.score > 80) msg += '\nüöÄ ¬°Excelente oferta! Es probable que un operador te acepte r√°pido.';

                alert(msg);
                switchTab('lobby');
            }

            function joinGroup(id) {
                const exp = expeditions.find(e => e.id === id);
                if (exp && exp.currentPax < exp.maxPax) {
                    // Simulate Join
                    const confirmJoin = confirm(`¬øUnirte a ${exp.target} por S/ ${exp.budget}?`);
                    if (confirmJoin) {
                        exp.currentPax++;
                        if (exp.currentPax >= exp.minPax) exp.status = 'ready'; // Upgrade status if quorum met
                        alert('¬°Te has unido al equipo! Prepara tu mochila.');
                        renderLobby();
                    }
                }
            }

            function shareLink(id) {
                const exp = expeditions.find(e => e.id === id);
                const text = `¬°Hola! Estoy armando un grupo para ir a *${exp.target}* el ${exp.date}. Nos sale a S/ ${exp.budget} cada uno. ¬øTe unes? Entra aqu√≠: lifextreme.store/community.html?id=${id}`;

                // Copy to clipboard or open WA
                if (navigator.share) {
                    navigator.share({
                        title: '√önete a mi Expedici√≥n Lifextreme',
                        text: text,
                        url: window.location.href
                    });
                } else {
                    window.open(`https://wa.me/?text=${encodeURIComponent(text)}`);
                }
            }

            function operatorAccept(id) {
                const exp = expeditions.find(e => e.id === id);
                const confirmOp = confirm(`¬øConfirmas que tienes la log√≠stica disponible para operar el grupo de ${exp.target} en la fecha ${exp.date}?`);

                if (confirmOp) {
                    exp.status = 'completed'; // Hide from lobby/operator view
                    alert('¬°Servicio Asignado! Contacta al L√≠der del grupo para coordinar el pago final.');
                    renderOperators();
                }
            }
        </script>

        <!-- CTA FINAL -->
        <section class="container mx-auto px-6 pb-20 text-center">
            <div
                class="bg-gradient-to-b from-white/10 to-transparent p-12 rounded-[3rem] border border-white/10 relative overflow-hidden">
                <div class="relative z-10">
                    <h2 class="text-4xl font-black italic mb-6">¬øListo para unirte?</h2>
                    <p class="text-slate-400 mb-8 max-w-lg mx-auto">S√© parte de los pioneros que est√°n cambiando la
                        forma de explorar los Andes.</p>
                    <form class="max-w-md mx-auto flex gap-2">
                        <input type="email" placeholder="Tu correo electr√≥nico"
                            class="flex-1 bg-slate-900 border border-slate-700 rounded-xl px-6 py-4 text-sm focus:border-primary outline-none">
                        <button type="button"
                            class="bg-primary hover:bg-primary/90 text-white font-black uppercase tracking-widest px-8 py-4 rounded-xl transition-all">
                            Entrar
                        </button>
                    </form>
                </div>
            </div>
        </section>

    </main>
</body>

</html>